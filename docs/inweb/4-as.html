<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>4/lm</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../webs.html">Sources</a></h1>
<ul>
<li><a href="../inweb/index.html">inweb</a></li>
</ul>
<h2>Foundation</h2>
<ul>
<li><a href="../foundation-module/index.html">foundation-module</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
</ul>


		</nav>
		<main role="main">
		
<!--Weave of '4/as' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">Source</a></li><li><a href="index.html">inweb</a></li><li><a href="index.html#4">Chapter 4: Languages</a></li><li><b>ACME Support</b></li></ul><p class="purpose">For generic programming languages by the ACME corporation.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. One Dozen ACME Explosive Tennis Balls</a></li><li><a href="#SP2">&#167;2. Tangling methods</a></li><li><a href="#SP5">&#167;5. Syntax colouring</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. One Dozen ACME Explosive Tennis Balls. </b>Older readers will remember that Wile E. Coyote, when wishing to frustrate
Road Runner with some ingenious device, would invariably buy it from the Acme
Corporation, which manufactured everything imaginable. See Wikipedia, "Acme
Corporation", for much else.
</p>

<p class="inwebparagraph">For us, ACME is an imaginary programming language, providing generic support
for comments and syntax colouring. Ironically, this code grew out of a language
actually called ACME: the 6502 assembler of the same name.
</p>


<pre class="display">
    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::add_fallbacks</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">PARSE_COMMENT_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">PARSE_COMMENT_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::parse_comment</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">COMMENT_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">COMMENT_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::comment</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">SHEBANG_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">SHEBANG_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::shebang</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">BEFORE_MACRO_EXPANSION_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">BEFORE_MACRO_EXPANSION_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::before_macro_expansion</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">AFTER_MACRO_EXPANSION_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">AFTER_MACRO_EXPANSION_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::after_macro_expansion</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">START_DEFN_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">START_DEFN_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::start_definition</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">PROLONG_DEFN_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">PROLONG_DEFN_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::prolong_definition</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">END_DEFN_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">END_DEFN_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::end_definition</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">OPEN_IFDEF_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">OPEN_IFDEF_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::I6_open_ifdef</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">CLOSE_IFDEF_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">CLOSE_IFDEF_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::I6_close_ifdef</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">INSERT_LINE_MARKER_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">INSERT_LINE_MARKER_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::insert_line_marker</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">SUPPRESS_DISCLAIMER_TAN_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">SUPPRESS_DISCLAIMER_TAN_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::suppress_disclaimer</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">BEGIN_WEAVE_WEA_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">BEGIN_WEAVE_WEA_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::begin_weave</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">RESET_SYNTAX_COLOURING_WEA_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">RESET_SYNTAX_COLOURING_WEA_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::reset_syntax_colouring</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Methods::provided</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">methods</span><span class="plain">, </span><span class="constant">SYNTAX_COLOUR_WEA_MTID</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">METHOD_ADD</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="constant">SYNTAX_COLOUR_WEA_MTID</span><span class="plain">, </span><span class="functiontext">ACMESupport::syntax_colour</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">prototype</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">N</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">prototype</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">prototype</span><span class="plain">); </span><span class="identifier">i</span><span class="plain">++) {</span>
                <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">prototype</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'%'</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">prototype</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">+1) == </span><span class="character">'S'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">S</span><span class="plain">)) {</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">S</span><span class="plain">);</span>
                    <span class="identifier">i</span><span class="plain">++;</span>
                <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'%'</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">prototype</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">+1) == </span><span class="character">'d'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">N</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">)) {</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d"</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">);</span>
                    <span class="identifier">i</span><span class="plain">++;</span>
                <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'%'</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">prototype</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">+1) == </span><span class="character">'f'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">F</span><span class="plain">)) {</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%/f"</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
                    <span class="identifier">i</span><span class="plain">++;</span>
                <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
                    <span class="identifier">PUT</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::add_fallbacks is used in 4/pl (<a href="4-pl.html#SP5_2">&#167;5.2</a>).</p>

<p class="endnote">The function ACMESupport::expand is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Tangling methods. </b></p>


<pre class="display">
    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::shebang</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">web</span><span class="plain"> *</span><span class="identifier">W</span><span class="plain">, </span><span class="reserved">tangle_target</span><span class="plain"> *</span><span class="identifier">target</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">shebang</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::before_macro_expansion</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">para_macro</span><span class="plain"> *</span><span class="identifier">pmac</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">before_macro_expansion</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::after_macro_expansion</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">para_macro</span><span class="plain"> *</span><span class="identifier">pmac</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">after_macro_expansion</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::start_definition</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">term</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">start</span><span class="plain">, </span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">start_definition</span><span class="plain">, </span><span class="identifier">term</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="functiontext">Tangler::tangle_code</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">start</span><span class="plain">, </span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::prolong_definition</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">more</span><span class="plain">, </span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">prolong_definition</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="functiontext">Tangler::tangle_code</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">more</span><span class="plain">, </span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::end_definition</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">end_definition</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::I6_open_ifdef</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">symbol</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">sense</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">sense</span><span class="plain">) </span><span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">start_ifdef</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="identifier">else</span><span class="plain"> </span><span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">start_ifndef</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::I6_close_ifdef</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">symbol</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">sense</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">sense</span><span class="plain">) </span><span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">end_ifdef</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="identifier">else</span><span class="plain"> </span><span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">end_ifndef</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::insert_line_marker</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">) {</span>
        <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">line_marker</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="plain">-&gt;</span><span class="element">source</span><span class="plain">.</span><span class="identifier">line_count</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">-&gt;</span><span class="element">source</span><span class="plain">.</span><span class="element">text_file_filename</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::comment</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">comm</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_open</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_open</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" %S "</span><span class="plain">, </span><span class="identifier">comm</span><span class="plain">);</span>
            <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_close</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">line_comment</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="functiontext">ACMESupport::expand</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">line_comment</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, -1, </span><span class="identifier">NULL</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">comm</span><span class="plain">);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>

    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::parse_comment</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">line</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">part_before_comment</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">part_within_comment</span><span class="plain">) {</span>
        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">q_mode</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">c_mode</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">non_white_space</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">c_position</span><span class="plain"> = -1, </span><span class="identifier">c_end</span><span class="plain"> = -1;</span>
        <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">); </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c_mode</span><span class="plain"> == </span><span class="constant">2</span><span class="plain">) {</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_close</span><span class="plain">)) {</span>
                    <span class="identifier">c_mode</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">; </span><span class="identifier">c_end</span><span class="plain"> = </span><span class="identifier">i</span><span class="plain">; </span><span class="identifier">i</span><span class="plain"> += </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_close</span><span class="plain">) - </span><span class="constant">1</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
                <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c_mode</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (!(</span><span class="functiontext">Characters::is_whitespace</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">)))) </span><span class="identifier">non_white_space</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">string_literal_escape</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">q_mode</span><span class="plain"> == </span><span class="constant">2</span><span class="plain">)) </span><span class="identifier">i</span><span class="plain"> += </span><span class="constant">1</span><span class="plain">;</span>
                <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">character_literal_escape</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">q_mode</span><span class="plain"> == </span><span class="constant">1</span><span class="plain">)) </span><span class="identifier">i</span><span class="plain"> += </span><span class="constant">1</span><span class="plain">;</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">string_literal</span><span class="plain">)) {</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">q_mode</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">q_mode</span><span class="plain"> = </span><span class="constant">2</span><span class="plain">;</span>
                    <span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="identifier">q_mode</span><span class="plain"> == </span><span class="constant">2</span><span class="plain">) </span><span class="identifier">q_mode</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">character_literal</span><span class="plain">)) {</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">q_mode</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">q_mode</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">;</span>
                    <span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="identifier">q_mode</span><span class="plain"> == </span><span class="constant">1</span><span class="plain">) </span><span class="identifier">q_mode</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_open</span><span class="plain">)) {</span>
                    <span class="identifier">c_mode</span><span class="plain"> = </span><span class="constant">2</span><span class="plain">; </span><span class="identifier">c_position</span><span class="plain"> = </span><span class="identifier">i</span><span class="plain">; </span><span class="identifier">non_white_space</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                    <span class="identifier">i</span><span class="plain"> += </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">multiline_comment_open</span><span class="plain">) - </span><span class="constant">1</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">line_comment</span><span class="plain">)) {</span>
                    <span class="identifier">c_mode</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">; </span><span class="identifier">c_position</span><span class="plain"> = </span><span class="identifier">i</span><span class="plain">; </span><span class="identifier">c_end</span><span class="plain"> = </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">); </span><span class="identifier">non_white_space</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                    <span class="identifier">i</span><span class="plain"> += </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">line_comment</span><span class="plain">) - </span><span class="constant">1</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c_position</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">non_white_space</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">)) {</span>
            <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">part_before_comment</span><span class="plain">);</span>
            <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">c_position</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) </span><span class="identifier">PUT_TO</span><span class="plain">(</span><span class="identifier">part_before_comment</span><span class="plain">, </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">));</span>
            <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">part_within_comment</span><span class="plain">);</span>
            <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">c_position</span><span class="plain"> + </span><span class="constant">2</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">c_end</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) </span><span class="identifier">PUT_TO</span><span class="plain">(</span><span class="identifier">part_within_comment</span><span class="plain">, </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">));</span>
            <span class="functiontext">Str::trim_white_space</span><span class="plain">(</span><span class="identifier">part_within_comment</span><span class="plain">);</span>
            <span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">pattern</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pattern</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">i</span><span class="plain"> &lt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">i</span><span class="plain"> + </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pattern</span><span class="plain">) &gt; </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">)) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">LOOP_THROUGH_TEXT</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">)</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) != </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">++))</span>
                <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::shebang is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::before_macro_expansion is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::after_macro_expansion is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::start_definition is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::prolong_definition is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::end_definition is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::I6_open_ifdef is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::I6_close_ifdef is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::insert_line_marker is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::comment is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::parse_comment is used in <a href="#SP1">&#167;1</a>.</p>

<p class="endnote">The function ACMESupport::text_at is used in <a href="#SP6_2">&#167;6.2</a>, <a href="#SP8">&#167;8</a>.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>This is here so that tangling the Standard Rules extension doesn't insert
a spurious comment betraying Inweb's involvement in the process.
</p>


<pre class="display">
    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::suppress_disclaimer</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">) {</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="identifier">suppress_disclaimer</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::suppress_disclaimer is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b></p>


<pre class="display">
    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::begin_weave</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">weave_target</span><span class="plain"> *</span><span class="identifier">wv</span><span class="plain">) {</span>
        <span class="reserved">reserved_word</span><span class="plain"> *</span><span class="identifier">rw</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">rw</span><span class="plain">, </span><span class="reserved">reserved_word</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">reserved_words</span><span class="plain">)</span>
            <span class="functiontext">Analyser::mark_reserved_word</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rw</span><span class="plain">-&gt;</span><span class="element">word</span><span class="plain">, </span><span class="identifier">rw</span><span class="plain">-&gt;</span><span class="element">colour</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::begin_weave is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5. Syntax colouring. </b>This is a very simple syntax colouring algorithm. The state at any given
time is a single variable, the current category of code being looked at:
</p>


<pre class="display">
    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::reset_syntax_colouring</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">) {</span>
        <span class="identifier">colouring_state</span><span class="plain"> = </span><span class="constant">PLAIN_COLOUR</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::reset_syntax_colouring is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b></p>


<pre class="display">
    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::syntax_colour</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">weave_target</span><span class="plain"> *</span><span class="identifier">wv</span><span class="plain">,</span>
        <span class="reserved">web</span><span class="plain"> *</span><span class="identifier">W</span><span class="plain">, </span><span class="reserved">chapter</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">, </span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">matter</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">colouring</span><span class="plain">) {</span>
        &lt;<span class="cwebmacro">Make preliminary colouring</span> <span class="cwebmacronumber">6.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Spot literal numerical constants</span> <span class="cwebmacronumber">6.2</span>&gt;<span class="plain">;</span>
        <span class="functiontext">ACMESupport::execute</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">program</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">));</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::syntax_colour is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP6_1"></a><b>&#167;6.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Make preliminary colouring</span> <span class="cwebmacronumber">6.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">squote</span><span class="plain"> = </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">character_literal</span><span class="plain">);</span>
        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">squote_escape</span><span class="plain"> = </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">character_literal_escape</span><span class="plain">);</span>
        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">dquote</span><span class="plain"> = </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">string_literal</span><span class="plain">);</span>
        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">dquote_escape</span><span class="plain"> = </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">string_literal_escape</span><span class="plain">);</span>
        <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain"> &lt; </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">); </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="identifier">int</span><span class="plain"> </span><span class="identifier">skip</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">one_off</span><span class="plain"> = -1, </span><span class="identifier">will_be</span><span class="plain"> = -1;</span>
            <span class="identifier">switch</span><span class="plain"> (</span><span class="identifier">colouring_state</span><span class="plain">) {</span>
                <span class="identifier">case</span><span class="plain"> </span><span class="identifier">PLAIN_COLOUR:</span><span class="plain"> {</span>
                    <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="identifier">dquote</span><span class="plain">) {</span>
                        <span class="identifier">colouring_state</span><span class="plain"> = </span><span class="constant">STRING_COLOUR</span><span class="plain">;</span>
                        <span class="identifier">break</span><span class="plain">;</span>
                    <span class="plain">}</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="identifier">squote</span><span class="plain">) {</span>
                        <span class="identifier">colouring_state</span><span class="plain"> = </span><span class="constant">CHAR_LITERAL_COLOUR</span><span class="plain">;</span>
                        <span class="identifier">break</span><span class="plain">;</span>
                    <span class="plain">}</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::identifier_at</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">))</span>
                        <span class="identifier">one_off</span><span class="plain"> = </span><span class="constant">IDENTIFIER_COLOUR</span><span class="plain">;</span>
                    <span class="identifier">break</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">case</span><span class="plain"> </span><span class="identifier">CHAR_LITERAL_COLOUR:</span><span class="plain"> {</span>
                    <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="identifier">squote</span><span class="plain">) </span><span class="identifier">will_be</span><span class="plain"> = </span><span class="constant">PLAIN_COLOUR</span><span class="plain">;</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="identifier">squote_escape</span><span class="plain">) </span><span class="identifier">skip</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">;</span>
                    <span class="identifier">break</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">case</span><span class="plain"> </span><span class="identifier">STRING_COLOUR:</span><span class="plain"> {</span>
                    <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="identifier">dquote</span><span class="plain">) </span><span class="identifier">will_be</span><span class="plain"> = </span><span class="constant">PLAIN_COLOUR</span><span class="plain">;</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="identifier">dquote_escape</span><span class="plain">) </span><span class="identifier">skip</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">;</span>
                    <span class="identifier">break</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">one_off</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) </span><span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="identifier">one_off</span><span class="plain">);</span>
            <span class="identifier">else</span><span class="plain"> </span><span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="identifier">colouring_state</span><span class="plain">);</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">will_be</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">colouring_state</span><span class="plain"> = (</span><span class="identifier">char</span><span class="plain">) </span><span class="identifier">will_be</span><span class="plain">;</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">skip</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">i</span><span class="plain"> += </span><span class="identifier">skip</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_2"></a><b>&#167;6.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Spot literal numerical constants</span> <span class="cwebmacronumber">6.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">base</span><span class="plain"> = -1, </span><span class="identifier">dec_possible</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain"> &lt; </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">); </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="identifier">if</span><span class="plain"> ((</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">) == </span><span class="constant">PLAIN_COLOUR</span><span class="plain">) ||</span>
                <span class="plain">(</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">) == </span><span class="constant">IDENTIFIER_COLOUR</span><span class="plain">)) {</span>
                <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">binary_literal_prefix</span><span class="plain">)) {</span>
                    <span class="identifier">base</span><span class="plain"> = </span><span class="constant">2</span><span class="plain">;</span>
                    <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">j</span><span class="plain">=0; </span><span class="identifier">j</span><span class="plain">&lt;</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">binary_literal_prefix</span><span class="plain">); </span><span class="identifier">j</span><span class="plain">++)</span>
                        <span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">+</span><span class="identifier">j</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="constant">CONSTANT_COLOUR</span><span class="plain">);</span>
                    <span class="identifier">dec_possible</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                    <span class="identifier">continue</span><span class="plain">;</span>
                <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">octal_literal_prefix</span><span class="plain">)) {</span>
                    <span class="identifier">base</span><span class="plain"> = </span><span class="constant">8</span><span class="plain">;</span>
                    <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">j</span><span class="plain">=0; </span><span class="identifier">j</span><span class="plain">&lt;</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">octal_literal_prefix</span><span class="plain">); </span><span class="identifier">j</span><span class="plain">++)</span>
                        <span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">+</span><span class="identifier">j</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="constant">CONSTANT_COLOUR</span><span class="plain">);</span>
                    <span class="identifier">dec_possible</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                    <span class="identifier">continue</span><span class="plain">;</span>
                <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">hexadecimal_literal_prefix</span><span class="plain">)) {</span>
                    <span class="identifier">base</span><span class="plain"> = </span><span class="constant">16</span><span class="plain">;</span>
                    <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">j</span><span class="plain">=0; </span><span class="identifier">j</span><span class="plain">&lt;</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">hexadecimal_literal_prefix</span><span class="plain">); </span><span class="identifier">j</span><span class="plain">++)</span>
                        <span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">+</span><span class="identifier">j</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="constant">CONSTANT_COLOUR</span><span class="plain">);</span>
                    <span class="identifier">dec_possible</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                    <span class="identifier">continue</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> ((</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">negative_literal_prefix</span><span class="plain">)) &amp;&amp;</span>
                    <span class="plain">(</span><span class="identifier">dec_possible</span><span class="plain">) &amp;&amp; (</span><span class="identifier">base</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">)) {</span>
                    <span class="identifier">base</span><span class="plain"> = </span><span class="constant">10</span><span class="plain">;</span>
                    <span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="constant">CONSTANT_COLOUR</span><span class="plain">);</span>
                    <span class="identifier">continue</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">int</span><span class="plain"> </span><span class="identifier">pass</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="identifier">switch</span><span class="plain"> (</span><span class="identifier">base</span><span class="plain">) {</span>
                    <span class="identifier">case</span><span class="plain"> -1:</span>
                        <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">dec_possible</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Characters::isdigit</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">))) {</span>
                            <span class="identifier">base</span><span class="plain"> = </span><span class="constant">10</span><span class="plain">; </span><span class="identifier">pass</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                        <span class="plain">}</span>
                        <span class="identifier">break</span><span class="plain">;</span>
                    <span class="identifier">case</span><span class="plain"> </span><span class="constant">2</span><span class="plain">: </span><span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'0'</span><span class="plain">) || (</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'1'</span><span class="plain">)) </span><span class="identifier">pass</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="identifier">break</span><span class="plain">;</span>
                    <span class="identifier">case</span><span class="plain"> </span><span class="constant">10</span><span class="plain">: </span><span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Characters::isdigit</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">)) </span><span class="identifier">pass</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="identifier">break</span><span class="plain">;</span>
                    <span class="identifier">case</span><span class="plain"> </span><span class="constant">16</span><span class="plain">: </span><span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Characters::isdigit</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">)) </span><span class="identifier">pass</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                        <span class="identifier">int</span><span class="plain"> </span><span class="identifier">d</span><span class="plain"> = </span><span class="functiontext">Characters::tolower</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">);</span>
                        <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">d</span><span class="plain"> == </span><span class="character">'a'</span><span class="plain">) || (</span><span class="identifier">d</span><span class="plain"> == </span><span class="character">'b'</span><span class="plain">) || (</span><span class="identifier">d</span><span class="plain"> == </span><span class="character">'c'</span><span class="plain">) ||</span>
                            <span class="plain">(</span><span class="identifier">d</span><span class="plain"> == </span><span class="character">'d'</span><span class="plain">) || (</span><span class="identifier">d</span><span class="plain"> == </span><span class="character">'e'</span><span class="plain">) || (</span><span class="identifier">d</span><span class="plain"> == </span><span class="character">'f'</span><span class="plain">)) </span><span class="identifier">pass</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                        <span class="identifier">break</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">pass</span><span class="plain">) {</span>
                    <span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, (</span><span class="identifier">char</span><span class="plain">) </span><span class="constant">CONSTANT_COLOUR</span><span class="plain">);</span>
                <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
                    <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Characters::is_whitespace</span><span class="plain">(</span><span class="identifier">c</span><span class="plain">)) </span><span class="identifier">dec_possible</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                    <span class="identifier">else</span><span class="plain"> </span><span class="identifier">dec_possible</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                    <span class="identifier">base</span><span class="plain"> = -1;</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b></p>


<pre class="display">
    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::identifier_at</span><span class="plain">(</span><span class="reserved">programming_language</span><span class="plain"> *</span><span class="identifier">pl</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">matter</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">) {</span>
        <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
        <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">i</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">-1) == </span><span class="constant">IDENTIFIER_COLOUR</span><span class="plain">)) {</span>
            <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'_'</span><span class="plain">) ||</span>
                <span class="plain">((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'A'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'Z'</span><span class="plain">)) ||</span>
                <span class="plain">((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'a'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'z'</span><span class="plain">)) ||</span>
                <span class="plain">((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'0'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'9'</span><span class="plain">))) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">':'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">pl</span><span class="plain">-&gt;</span><span class="element">supports_namespaces</span><span class="plain">)) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">d</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">i</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">d</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
            <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">d</span><span class="plain"> &gt;= </span><span class="character">'0'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">d</span><span class="plain"> &lt;= </span><span class="character">'9'</span><span class="plain">)) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'_'</span><span class="plain">) ||</span>
                <span class="plain">((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'A'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'Z'</span><span class="plain">)) ||</span>
                <span class="plain">((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'a'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'z'</span><span class="plain">))) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::identifier_at is used in <a href="#SP6_1">&#167;6.1</a>.</p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b></p>


<pre class="display">
    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::execute</span><span class="plain">(</span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">colouring_language_block</span><span class="plain"> *</span><span class="identifier">block</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">matter</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">to</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">block</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"no block"</span><span class="plain">);</span>
        <span class="reserved">colouring_rule</span><span class="plain"> *</span><span class="identifier">rule</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">rule</span><span class="plain">, </span><span class="reserved">colouring_rule</span><span class="plain">, </span><span class="identifier">block</span><span class="plain">-&gt;</span><span class="element">rules</span><span class="plain">) {</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">block</span><span class="plain">-&gt;</span><span class="identifier">run</span><span class="plain"> == </span><span class="constant">CHARACTERS_CRULE_RUN</span><span class="plain">) {</span>
                <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;=</span><span class="identifier">to</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++)</span>
                    <span class="functiontext">ACMESupport::execute_rule</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
            <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="identifier">block</span><span class="plain">-&gt;</span><span class="element">run</span><span class="plain"> == </span><span class="constant">WHOLE_LINE_CRULE_RUN</span><span class="plain">) {</span>
                <span class="functiontext">ACMESupport::execute_rule</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">);</span>
            <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
                <span class="identifier">int</span><span class="plain"> </span><span class="identifier">ident_from</span><span class="plain"> = -1;</span>
                <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;=</span><span class="identifier">to</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) {</span>
                    <span class="identifier">int</span><span class="plain"> </span><span class="identifier">col</span><span class="plain"> = </span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                    <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">col</span><span class="plain"> == </span><span class="identifier">block</span><span class="plain">-&gt;</span><span class="element">run</span><span class="plain">) ||</span>
                        <span class="plain">((</span><span class="identifier">block</span><span class="plain">-&gt;</span><span class="element">run</span><span class="plain"> == </span><span class="constant">UNQUOTED_COLOUR</span><span class="plain">) &amp;&amp;</span>
                            <span class="plain">((</span><span class="identifier">col</span><span class="plain"> != </span><span class="constant">STRING_COLOUR</span><span class="plain">) &amp;&amp; (</span><span class="identifier">col</span><span class="plain"> != </span><span class="constant">CHAR_LITERAL_COLOUR</span><span class="plain">)))) {</span>
                        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">ident_from</span><span class="plain"> == -1) </span><span class="identifier">ident_from</span><span class="plain"> = </span><span class="identifier">i</span><span class="plain">;</span>
                    <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
                        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">ident_from</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">)</span>
                            <span class="functiontext">ACMESupport::execute_rule</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">ident_from</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">-1);</span>
                        <span class="identifier">ident_from</span><span class="plain"> = -1;</span>
                    <span class="plain">}</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">ident_from</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">)</span>
                    <span class="functiontext">ACMESupport::execute_rule</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">ident_from</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::execute_rule</span><span class="plain">(</span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">colouring_rule</span><span class="plain"> *</span><span class="identifier">rule</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">matter</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">to</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::satisfies</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">))</span>
            <span class="functiontext">ACMESupport::follow</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="identifier">int</span><span class="plain"> </span><span class="functiontext">ACMESupport::satisfies</span><span class="plain">(</span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">colouring_rule</span><span class="plain"> *</span><span class="identifier">rule</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">matter</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">to</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_text</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="identifier">match_prefix</span><span class="plain"> != </span><span class="constant">NOT_A_RULE_PREFIX</span><span class="plain">) {</span>
                <span class="identifier">int</span><span class="plain"> </span><span class="identifier">pos</span><span class="plain"> = </span><span class="identifier">from</span><span class="plain">;</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="identifier">match_prefix</span><span class="plain"> != </span><span class="constant">UNSPACED_RULE_PREFIX</span><span class="plain">) {</span>
                    <span class="identifier">while</span><span class="plain"> ((</span><span class="identifier">pos</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Characters::is_whitespace</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">-1))) </span><span class="identifier">pos</span><span class="plain">--;</span>
                    <span class="identifier">if</span><span class="plain"> ((</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="identifier">match_prefix</span><span class="plain"> == </span><span class="constant">SPACED_RULE_PREFIX</span><span class="plain">) &amp;&amp; (</span><span class="identifier">pos</span><span class="plain"> == </span><span class="identifier">from</span><span class="plain">))</span>
                        <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">ACMESupport::text_at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">pos</span><span class="plain">-</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_text</span><span class="plain">), </span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_text</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
                    <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="plain">} </span><span class="identifier">else</span><span class="plain"> {</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::ne</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_text</span><span class="plain">)) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_keyword_of_colour</span><span class="plain"> != </span><span class="constant">NOT_A_COLOUR</span><span class="plain">) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">id</span><span class="plain">);</span>
            <span class="functiontext">Str::substr</span><span class="plain">(</span><span class="identifier">id</span><span class="plain">, </span><span class="functiontext">Str::at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">), </span><span class="functiontext">Str::at</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">+1));</span>
            <span class="identifier">int</span><span class="plain"> </span><span class="identifier">rw</span><span class="plain"> = </span><span class="functiontext">Analyser::is_reserved_word</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">id</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_keyword_of_colour</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">id</span><span class="plain">);</span>
            <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">rw</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">) </span><span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="plain">} </span><span class="identifier">else</span><span class="plain"> </span><span class="identifier">if</span><span class="plain"> (</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_colour</span><span class="plain"> != </span><span class="constant">NOT_A_COLOUR</span><span class="plain">) {</span>
            <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;=</span><span class="identifier">to</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++)</span>
                <span class="identifier">if</span><span class="plain"> (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">) != </span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">match_colour</span><span class="plain">)</span>
                    <span class="identifier">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">void</span><span class="plain"> </span><span class="functiontext">ACMESupport::follow</span><span class="plain">(</span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">colouring_rule</span><span class="plain"> *</span><span class="identifier">rule</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">matter</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">to</span><span class="plain">) {</span>
        <span class="identifier">if</span><span class="plain"> (</span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="identifier">execute_block</span><span class="plain">)</span>
            <span class="functiontext">ACMESupport::execute</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">execute_block</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">);</span>
        <span class="identifier">else</span>
            <span class="identifier">for</span><span class="plain"> (</span><span class="identifier">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;=</span><span class="identifier">to</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++)</span>
                <span class="functiontext">Str::put_at</span><span class="plain">(</span><span class="identifier">colouring</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">rule</span><span class="plain">-&gt;</span><span class="element">set_to_colour</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function ACMESupport::execute is used in <a href="#SP6">&#167;6</a>.</p>

<p class="endnote">The function ACMESupport::execute_rule appears nowhere else.</p>

<p class="endnote">The function ACMESupport::satisfies appears nowhere else.</p>

<p class="endnote">The function ACMESupport::follow appears nowhere else.</p>

<hr class="tocbar">
<ul class="toc"><li><a href="4-lm.html">Back to 'Language Methods'</a></li><li><a href="4-cl.html">Continue with 'C-Like Languages'</a></li></ul><hr class="tocbar">
<!--End of weave-->
		</main>
	</body>
</html>

