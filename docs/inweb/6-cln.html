<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Colonies</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../..//docs/docs-src/Figures/Octagram184x184.png" width=72 height=72">
</a></h1>
<ul><li><a href="index.html"><span class="selectedlink">inweb</span></a></li>
</ul><h2>Foundation Module</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
</ul><h2>External</h2><ul>
<li><a href="https://github.com/ganelson/inweb">github</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Colonies' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">inweb</a></li><li><a href="index.html#6">Chapter 6: Extras</a></li><li><b>Colonies</b></li></ul><p class="purpose">Cross-referencing multiple webs gathered together.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Colonies of webs</a></li><li><a href="#SP7">&#167;7. Searching</a></li><li><a href="#SP10">&#167;10. Cross-references</a></li><li><a href="#SP11">&#167;11. URL management</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Colonies of webs. </b>Social spiders are said to form "colonies" when their webs are shared,<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> and
in that spirit, a colony to Inweb is a collection of coexisting webs &mdash; which
share no code, and in that sense have no connection at run-time, but which
need to be cross-referenced in their woven form, so that readers can easily
turn from one to another.
</p>

<p class="inwebparagraph"><li class="footnote" id="fn:1"><p><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> Those curious to see what a colony of 110,000,000 spiders might be like
to walk through should see Albert Greene et al., "An Immense Concentration of
Orb-Weaving Spiders With Communal Webbing in a Man-Made Structural Habitat
(Arachnida: Araneae: Tetragnathidae, Araneidae)", American Entomologist
(Fall 2010), at: <a href="https://www.entsoc.org/PDF/2010/Orb-weaving-spiders.pdf
" class="external">https://www.entsoc.org/PDF/2010/Orb-weaving-spiders.pdf
</a><a href="#fnref:1" title="return to text"> &#x21A9;</a></p></li></p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>So, then, a colony is really just a membership list:
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">colony</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">members</span><span class="plain">; </span><span class="comment"> of <code class="display"><span class="extract">colony_member</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">home</span><span class="plain">; </span><span class="comment"> path of home repository</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">colony</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure colony is private to this section.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>Each member is represented by an instance of the following. Note the <code class="display"><span class="extract">loaded</span></code>
field: this holds metadata on the web/module in question. (Recall that a module
is really just a web that doesn't tangle to an independent program but to a
library of code: for almost all purposes, it's a web.) But for efficiency's
sake, we read this metadata only on demand.
</p>

<p class="inwebparagraph">Note that the <code class="display"><span class="extract">path</span></code> might be either the name of a single-file web, or of a
directory holding a multi-section web.
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">colony_member</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">web_rather_than_module</span><span class="plain">; </span><span class="comment"> <code class="display"><span class="extract">TRUE</span></code> for a web, <code class="display"><span class="extract">FALSE</span></code> for a module</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">; </span><span class="comment"> the <code class="display"><span class="extract">N</span></code> in <code class="display"><span class="extract">N at P in W</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">path</span><span class="plain">; </span><span class="comment"> the <code class="display"><span class="extract">P</span></code> in <code class="display"><span class="extract">N at P in W</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">weave_path</span><span class="plain">; </span><span class="comment"> the <code class="display"><span class="extract">W</span></code> in <code class="display"><span class="extract">N at P in W</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">home_leaf</span><span class="plain">; </span><span class="comment"> usually <code class="display"><span class="extract">index.html</span></code>, but not for single-file webs</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">default_weave_pattern</span><span class="plain">; </span><span class="comment"> for use when weaving</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">web_md</span><span class="plain"> *</span><span class="identifier">loaded</span><span class="plain">; </span><span class="comment"> metadata on its sections, lazily evaluated</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">navigation</span><span class="plain">; </span><span class="comment"> navigation sidebar HTML</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">breadcrumb_tail</span><span class="plain">; </span><span class="comment"> of <code class="display"><span class="extract">breadcrumb_request</span></code></span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">colony_member</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure colony_member is accessed in 1/cnf, 3/ts, 3/ti, 6/rw and here.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>And the following reads a colony file <code class="display"><span class="extract">F</span></code> and produces a suitable <code class="display"><span class="extract">colony</span></code>
object from it. This, for example, is the colony file for the Inweb repository
at GitHub:
</p>

<pre class="display">
    <span class="plain">navigation: inweb/docs/docs-src/nav.html</span>
    <span class="plain">pattern: GitHubPages</span>

    <span class="plain">breadcrumbs: none</span>
    <span class="plain">web: "overview" at "inweb/docs/docs-src/index.inweb" in "inweb/docs"</span>

    <span class="plain">breadcrumbs: "Home: //overview//"</span>
    <span class="plain">web: "inweb" at "inweb" in "inweb/docs/inweb"</span>
    <span class="plain">module: "foundation-module" at "inweb/foundation-module" in "inweb/docs/foundation-module"</span>
    <span class="plain">web: "foundation-test" at "inweb/foundation-test" in "inweb/docs/foundation-test"</span>
    <span class="plain">web: "goldbach" at "inweb/Examples/goldbach" in "inweb/docs/goldbach"</span>
    <span class="plain">web: "twinprimes" at "inweb/Examples/twinprimes.inweb" in "inweb/docs/twinprimes"</span>
</pre>

<p class="inwebparagraph"></p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">colony_reader_state</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">colony</span><span class="plain"> *</span><span class="identifier">province</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">nav</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">crumbs</span><span class="plain">; </span><span class="comment"> of <code class="display"><span class="extract">breadcrumb_request</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">pattern</span><span class="plain">;</span>
    <span class="plain">} </span><span class="reserved">colony_reader_state</span><span class="plain">;</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::load<button class="popup" onclick="togglePopup('usagePopup360')">...<span class="popuptext" id="usagePopup360">Usage of <b>Colonies::load</b>:<br>Configuration - <a href="1-cnf.html#SP2_5">&#167;2.5</a></span></button></span><span class="plain">(</span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">) {</span>
        <span class="reserved">colony</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">colony</span><span class="plain">);</span>
        <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">members</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">colony_member</span><span class="plain">);</span>
        <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">home</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"docs"</span><span class="plain">;</span>
        <span class="reserved">colony_reader_state</span><span class="plain"> </span><span class="identifier">crs</span><span class="plain">;</span>
        <span class="identifier">crs</span><span class="plain">.</span><span class="element">province</span><span class="plain"> = </span><span class="identifier">C</span><span class="plain">;</span>
        <span class="identifier">crs</span><span class="plain">.</span><span class="element">nav</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">crs</span><span class="plain">.</span><span class="element">crumbs</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">breadcrumb_request</span><span class="plain">);</span>
        <span class="identifier">crs</span><span class="plain">.</span><span class="element">pattern</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="functiontext"><a href="4-tf.html#SP5">TextFiles::read</a></span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"can't open colony file"</span><span class="plain">,</span>
            <span class="constant">TRUE</span><span class="plain">, </span><span class="functiontext"><a href="#SP5">Colonies::read_line</a></span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, (</span><span class="reserved">void</span><span class="plain"> *) &amp;</span><span class="identifier">crs</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure colony_reader_state is accessed in 3/ts, 3/ti, 3/tw, 5/tf, 5/hf, 5/rtt and here.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b>Lines from the colony file are fed, one by one, into:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::read_line<button class="popup" onclick="togglePopup('usagePopup361')">...<span class="popuptext" id="usagePopup361">Usage of <b>Colonies::read_line</b>:<br><a href="#SP4">&#167;4</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">line</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">v_crs</span><span class="plain">) {</span>
        <span class="reserved">colony_reader_state</span><span class="plain"> *</span><span class="identifier">crs</span><span class="plain"> = (</span><span class="reserved">colony_reader_state</span><span class="plain"> *) </span><span class="identifier">v_crs</span><span class="plain">;</span>
        <span class="reserved">colony</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">province</span><span class="plain">;</span>

        <span class="functiontext"><a href="4-sm.html#SP23">Str::trim_white_space</a></span><span class="plain">(</span><span class="identifier">line</span><span class="plain">); </span><span class="comment"> ignore trailing space</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">line</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">; </span><span class="comment"> ignore blank lines</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_first_char</a></span><span class="plain">(</span><span class="identifier">line</span><span class="plain">) == </span><span class="character">'#'</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">; /* </span><span class="identifier">lines</span><span class="plain"> </span><span class="identifier">opening</span><span class="plain"> </span><span class="identifier">with</span><span class="plain"> |#| </span><span class="identifier">are</span><span class="plain"> </span><span class="identifier">comments</span><span class="plain"> */</span>

        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?): \"*(%C+)\" at \"(%c*)\" in \"(%c*)\""</span><span class="plain">)) {</span>
            <span class="reserved">colony_member</span><span class="plain"> *</span><span class="identifier">CM</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">colony_member</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">I</span><span class="string">"web"</span><span class="plain">)) </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">web_rather_than_module</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">I</span><span class="string">"module"</span><span class="plain">)) </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">web_rather_than_module</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">web_rather_than_module</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"text before ':' must be 'web' or 'module'"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">name</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">path</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[2]);</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">home_leaf</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP2">Str::new</a></span><span class="plain">();</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP20">Str::suffix_eq</a></span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">path</span><span class="plain">, </span><span class="identifier">I</span><span class="string">".inweb"</span><span class="plain">, </span><span class="constant">6</span><span class="plain">)) {</span>
                <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">path</span><span class="plain">);</span>
                <span class="functiontext"><a href="3-fln.html#SP7">Filenames::write_unextended_leafname</a></span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">home_leaf</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">home_leaf</span><span class="plain">, </span><span class="string">".html"</span><span class="plain">);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">home_leaf</span><span class="plain">, </span><span class="string">"index.html"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">weave_path</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP5">Pathnames::from_text</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[3]);</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">navigation</span><span class="plain"> = </span><span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">nav</span><span class="plain">;</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">breadcrumb_tail</span><span class="plain"> = </span><span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">crumbs</span><span class="plain">;</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">default_weave_pattern</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">pattern</span><span class="plain">);</span>
            <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">, </span><span class="reserved">colony_member</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">members</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"home: *(%c*)"</span><span class="plain">)) {</span>
            <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">home</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"pattern: none"</span><span class="plain">)) {</span>
            <span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">pattern</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"pattern: *(%c*)"</span><span class="plain">)) {</span>
            <span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">pattern</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="identifier">exp</span><span class="plain">[0]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"navigation: none"</span><span class="plain">)) {</span>
            <span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">nav</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"navigation: *(%c*)"</span><span class="plain">)) {</span>
            <span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">nav</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"breadcrumbs: none"</span><span class="plain">)) {</span>
            <span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">crumbs</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">breadcrumb_request</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"breadcrumbs: *(%c*)"</span><span class="plain">)) {</span>
            <span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">crumbs</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">breadcrumb_request</span><span class="plain">);</span>
            <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr2</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
            <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">L</span><span class="string">"(\"%c*?\") &gt; (%c*)"</span><span class="plain">)) {</span>
                <span class="functiontext"><a href="#SP6">Colonies::add_crumb</a></span><span class="plain">(</span><span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">crumbs</span><span class="plain">, </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">tfp</span><span class="plain">);</span>
                <span class="functiontext"><a href="4-sm.html#SP15">Str::clear</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]); </span><span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
            <span class="plain">}</span>
            <span class="functiontext"><a href="#SP6">Colonies::add_crumb</a></span><span class="plain">(</span><span class="identifier">crs</span><span class="plain">-&gt;</span><span class="element">crumbs</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"unable to read colony member"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b>"Breadcrumbs" are the chain of links in a horizontal list at the top of
the page, and this requests one.
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::add_crumb<button class="popup" onclick="togglePopup('usagePopup362')">...<span class="popuptext" id="usagePopup362">Usage of <b>Colonies::add_crumb</b>:<br><a href="#SP5">&#167;5</a></span></button></span><span class="plain">(</span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">spec</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">spec</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"\"(%c*?)\""</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">) {</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"each crumb must be in double-quotes"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">spec</span><span class="plain"> = </span><span class="identifier">mr</span><span class="plain">.</span><span class="identifier">exp</span><span class="plain">[0];</span>
        <span class="reserved">breadcrumb_request</span><span class="plain"> *</span><span class="identifier">br</span><span class="plain"> = </span><span class="functiontext"><a href="#SP6">Colonies::request_breadcrumb</a></span><span class="plain">(</span><span class="identifier">spec</span><span class="plain">);</span>
        <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">br</span><span class="plain">, </span><span class="reserved">breadcrumb_request</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">breadcrumb_request</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">breadcrumb_text</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">breadcrumb_link</span><span class="plain">;</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">breadcrumb_request</span><span class="plain">;</span>

    <span class="reserved">breadcrumb_request</span><span class="plain"> *</span><span class="functiontext">Colonies::request_breadcrumb<button class="popup" onclick="togglePopup('usagePopup363')">...<span class="popuptext" id="usagePopup363">Usage of <b>Colonies::request_breadcrumb</b>:<br>Configuration - <a href="1-cnf.html#SP2_4">&#167;2.4</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">arg</span><span class="plain">) {</span>
        <span class="reserved">breadcrumb_request</span><span class="plain"> *</span><span class="identifier">BR</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">breadcrumb_request</span><span class="plain">);</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">arg</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?): *(%c*)"</span><span class="plain">)) {</span>
            <span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_text</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
            <span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_link</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_text</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">arg</span><span class="plain">);</span>
            <span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_link</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">arg</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_link</span><span class="plain">, </span><span class="string">".html"</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">BR</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::drop_initial_breadcrumbs<button class="popup" onclick="togglePopup('usagePopup364')">...<span class="popuptext" id="usagePopup364">Usage of <b>Colonies::drop_initial_breadcrumbs</b>:<br>The Indexer - <a href="3-ti.html#SP6_1_8_3">&#167;6.1.8.3</a><br>HTML Formats - <a href="5-hf.html#SP8">&#167;8</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">crumbs</span><span class="plain">) {</span>
        <span class="reserved">breadcrumb_request</span><span class="plain"> *</span><span class="identifier">BR</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">BR</span><span class="plain">, </span><span class="reserved">breadcrumb_request</span><span class="plain">, </span><span class="identifier">crumbs</span><span class="plain">) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">url</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP11">Colonies::link_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_link</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP6">Colonies::write_breadcrumb</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">BR</span><span class="plain">-&gt;</span><span class="element">breadcrumb_text</span><span class="plain">, </span><span class="identifier">url</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">url</span><span class="plain">);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::write_breadcrumb<button class="popup" onclick="togglePopup('usagePopup365')">...<span class="popuptext" id="usagePopup365">Usage of <b>Colonies::write_breadcrumb</b>:<br>HTML Formats - <a href="5-hf.html#SP8">&#167;8</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">link</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">link</span><span class="plain">) {</span>
            <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"li"</span><span class="plain">);</span>
            <span class="functiontext"><a href="5-htm.html#SP15">HTML::begin_link</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">link</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
            <span class="functiontext"><a href="5-htm.html#SP15">HTML::end_link</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"li"</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"li"</span><span class="plain">);</span>
            <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"b"</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"b"</span><span class="plain">);</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"li"</span><span class="plain">);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure breadcrumb_request is private to this section.</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7. Searching. </b>Given a name <code class="display"><span class="extract">T</span></code>, we try to find a colony member of that name, returning the
first we find.
</p>

<pre class="display">
    <span class="reserved">colony_member</span><span class="plain"> *</span><span class="functiontext">Colonies::find<button class="popup" onclick="togglePopup('usagePopup366')">...<span class="popuptext" id="usagePopup366">Usage of <b>Colonies::find</b>:<br><a href="#SP10_1">&#167;10.1</a>, <a href="#SP10_2">&#167;10.2</a>, Configuration - <a href="1-cnf.html#SP2_5">&#167;2.5</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">T</span><span class="plain">) {</span>
        <span class="reserved">colony</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">, </span><span class="reserved">colony</span><span class="plain">) {</span>
            <span class="reserved">colony_member</span><span class="plain"> *</span><span class="identifier">CM</span><span class="plain">;</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">, </span><span class="reserved">colony_member</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">members</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq_insensitive</a></span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">name</span><span class="plain">))</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">CM</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b>And this is where we find the web metadata for a colony member. It's a
more subtle business than first appears, because maybe the colony member is
already in Inweb's memory (because it is the web being woven, or is a module
imported by that web even if not now being woven). If it is, we want to use
the data we already have; but if not, we read it in.
</p>

<pre class="display">
    <span class="reserved">module</span><span class="plain"> *</span><span class="functiontext">Colonies::as_module<button class="popup" onclick="togglePopup('usagePopup367')">...<span class="popuptext" id="usagePopup367">Usage of <b>Colonies::as_module</b>:<br><a href="#SP10_1">&#167;10.1</a>, <a href="#SP10_2">&#167;10.2</a></span></button></span><span class="plain">(</span><span class="reserved">colony_member</span><span class="plain"> *</span><span class="identifier">CM</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="reserved">web_md</span><span class="plain"> *</span><span class="identifier">Wm</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perhaps the web being woven</span> <span class="cwebmacronumber">8.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perhaps a module imported by the web being woven</span> <span class="cwebmacronumber">8.2</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perhaps a module not yet seen</span> <span class="cwebmacronumber">8.3</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span>&lt;<span class="cwebmacro">Failing that, throw an error</span> <span class="cwebmacronumber">8.4</span>&gt;<span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="identifier">loaded</span><span class="plain">-&gt;</span><span class="element">as_module</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP8_1"></a><b>&#167;8.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perhaps the web being woven</span> <span class="cwebmacronumber">8.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">Wm</span><span class="plain">) &amp;&amp; (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq_insensitive</a></span><span class="plain">(</span><span class="identifier">Wm</span><span class="plain">-&gt;</span><span class="element">as_module</span><span class="plain">-&gt;</span><span class="element">module_name</span><span class="plain">, </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">name</span><span class="plain">)))</span>
            <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> = </span><span class="identifier">Wm</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP8">&#167;8</a>.</p>

<p class="inwebparagraph"><a id="SP8_2"></a><b>&#167;8.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perhaps a module imported by the web being woven</span> <span class="cwebmacronumber">8.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Wm</span><span class="plain">) {</span>
            <span class="reserved">module</span><span class="plain"> *</span><span class="identifier">M</span><span class="plain">;</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="reserved">module</span><span class="plain">, </span><span class="identifier">Wm</span><span class="plain">-&gt;</span><span class="element">as_module</span><span class="plain">-&gt;</span><span class="element">dependencies</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq_insensitive</a></span><span class="plain">(</span><span class="identifier">M</span><span class="plain">-&gt;</span><span class="element">module_name</span><span class="plain">, </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">name</span><span class="plain">))</span>
                    <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> = </span><span class="identifier">Wm</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP8">&#167;8</a>.</p>

<p class="inwebparagraph"><a id="SP8_3"></a><b>&#167;8.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perhaps a module not yet seen</span> <span class="cwebmacronumber">8.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP20">Str::suffix_eq</a></span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">path</span><span class="plain">, </span><span class="identifier">I</span><span class="string">".inweb"</span><span class="plain">, </span><span class="constant">6</span><span class="plain">))</span>
            <span class="identifier">F</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">path</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="identifier">P</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP5">Pathnames::from_text</a></span><span class="plain">(</span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">path</span><span class="plain">);</span>
        <span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">loaded</span><span class="plain"> = </span><span class="functiontext"><a href="8-ws.html#SP5">WebMetadata::get_without_modules</a></span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP8">&#167;8</a>.</p>

<p class="inwebparagraph"><a id="SP8_4"></a><b>&#167;8.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Failing that, throw an error</span> <span class="cwebmacronumber">8.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">err</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">err</span><span class="plain">, </span><span class="string">"unable to load '%S'"</span><span class="plain">, </span><span class="identifier">CM</span><span class="plain">-&gt;</span><span class="element">name</span><span class="plain">);</span>
        <span class="functiontext"><a href="1-pc.html#SP8">Main::error_in_web</a></span><span class="plain">(</span><span class="identifier">err</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP8">&#167;8</a>.</p>

<p class="inwebparagraph"><a id="SP9"></a><b>&#167;9.  </b>Finally:
</p>

<pre class="display">
    <span class="reserved">text_stream</span><span class="plain"> *</span><span class="functiontext">Colonies::home<button class="popup" onclick="togglePopup('usagePopup368')">...<span class="popuptext" id="usagePopup368">Usage of <b>Colonies::home</b>:<br>The Indexer - <a href="3-ti.html#SP6_1_8_9">&#167;6.1.8.9</a></span></button></span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">colony</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">, </span><span class="reserved">colony</span><span class="plain">)</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="identifier">home</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"docs"</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP10"></a><b>&#167;10. Cross-references. </b>The following must decide what references like the following should refer to:
</p>

<pre class="display">
        <span class="plain">Chapter 3</span>
        <span class="plain">Manual</span>
        <span class="plain">Enumerated Constants</span>
        <span class="plain">Reader::get_section_for_range</span>
        <span class="plain">weave_target</span>
        <span class="plain">foundation: Text Streams</span>
        <span class="plain">goldbach</span>
</pre>

<p class="inwebparagraph">The reference text is in <code class="display"><span class="extract">text</span></code>; we return <code class="display"><span class="extract">TRUE</span></code> if we can make unambiguous
sense of it, or throw an error and return <code class="display"><span class="extract">FALSE</span></code> if not. If all is well, we
must write a title and URL for the link.
</p>

<p class="inwebparagraph">The web metadata <code class="display"><span class="extract">Wm</span></code> is for the web currently being woven, and the line <code class="display"><span class="extract">L</span></code>
is where the reference is made from.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Colonies::resolve_reference_in_weave<button class="popup" onclick="togglePopup('usagePopup369')">...<span class="popuptext" id="usagePopup369">Usage of <b>Colonies::resolve_reference_in_weave</b>:<br><a href="#SP11">&#167;11</a>, Format Methods - <a href="5-fm.html#SP27_4_1">&#167;27.4.1</a><br>HTML Formats - <a href="5-hf.html#SP9_2_1">&#167;9.2.1</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">url</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">title</span><span class="plain">,</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">for_HTML_file</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">web_md</span><span class="plain"> *</span><span class="identifier">Wm</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">) {</span>
        <span class="reserved">module</span><span class="plain"> *</span><span class="identifier">from_M</span><span class="plain"> = (</span><span class="identifier">Wm</span><span class="plain">)?(</span><span class="identifier">Wm</span><span class="plain">-&gt;</span><span class="element">as_module</span><span class="plain">):</span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">module</span><span class="plain"> *</span><span class="identifier">search_M</span><span class="plain"> = </span><span class="identifier">from_M</span><span class="plain">;</span>
        <span class="reserved">colony_member</span><span class="plain"> *</span><span class="identifier">search_CM</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">external</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>

        &lt;<span class="cwebmacro">Is it the name of a member of our colony?</span> <span class="cwebmacronumber">10.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">If it contains a colon, does this indicate a section in a colony member?</span> <span class="cwebmacronumber">10.2</span>&gt;<span class="plain">;</span>

        <span class="reserved">module</span><span class="plain"> *</span><span class="identifier">found_M</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">section_md</span><span class="plain"> *</span><span class="identifier">found_Sm</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">bare_module_name</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">N</span><span class="plain"> = </span><span class="functiontext"><a href="8-wm.html#SP9">WebModules::named_reference</a></span><span class="plain">(&amp;</span><span class="identifier">found_M</span><span class="plain">, &amp;</span><span class="identifier">found_Sm</span><span class="plain">, &amp;</span><span class="identifier">bare_module_name</span><span class="plain">,</span>
            <span class="identifier">title</span><span class="plain">, </span><span class="identifier">search_M</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">N</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">L</span><span class="plain">) &amp;&amp; (</span><span class="identifier">external</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">)) {</span>
                &lt;<span class="cwebmacro">Is it the name of a function in the current web?</span> <span class="cwebmacronumber">10.3</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Is it the name of a type in the current web?</span> <span class="cwebmacronumber">10.4</span>&gt;<span class="plain">;</span>
            <span class="plain">}</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">err</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">err</span><span class="plain">, </span><span class="string">"Can't find the cross-reference '%S'"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
            <span class="functiontext"><a href="1-pc.html#SP8">Main::error_in_web</a></span><span class="plain">(</span><span class="identifier">err</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">err</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">N</span><span class="plain"> &gt; </span><span class="constant">1</span><span class="plain">) {</span>
            <span class="functiontext"><a href="1-pc.html#SP8">Main::error_in_web</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Multiple cross-references might be meant here"</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
            <span class="functiontext"><a href="8-wm.html#SP9">WebModules::named_reference</a></span><span class="plain">(&amp;</span><span class="identifier">found_M</span><span class="plain">, &amp;</span><span class="identifier">found_Sm</span><span class="plain">, &amp;</span><span class="identifier">bare_module_name</span><span class="plain">,</span>
                <span class="identifier">title</span><span class="plain">, </span><span class="identifier">search_M</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            &lt;<span class="cwebmacro">It refers unambiguously to a single section</span> <span class="cwebmacronumber">10.5</span>&gt;<span class="plain">;</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP10_1"></a><b>&#167;10.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Is it the name of a member of our colony?</span> <span class="cwebmacronumber">10.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">search_CM</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Colonies::find</a></span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">search_CM</span><span class="plain">) {</span>
            <span class="reserved">module</span><span class="plain"> *</span><span class="identifier">found_M</span><span class="plain"> = </span><span class="functiontext"><a href="#SP8">Colonies::as_module</a></span><span class="plain">(</span><span class="identifier">search_CM</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">Wm</span><span class="plain">);</span>
            <span class="reserved">section_md</span><span class="plain"> *</span><span class="identifier">found_Sm</span><span class="plain"> = </span><span class="identifier">FIRST_IN_LINKED_LIST</span><span class="plain">(</span><span class="reserved">section_md</span><span class="plain">, </span><span class="identifier">found_M</span><span class="plain">-&gt;</span><span class="element">sections_md</span><span class="plain">);</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">bare_module_name</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">search_CM</span><span class="plain">-&gt;</span><span class="identifier">name</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">It refers unambiguously to a single section</span> <span class="cwebmacronumber">10.5</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10">&#167;10</a>.</p>

<p class="inwebparagraph"><a id="SP10_2"></a><b>&#167;10.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">If it contains a colon, does this indicate a section in a colony member?</span> <span class="cwebmacronumber">10.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?): (%c*)"</span><span class="plain">)) {</span>
            <span class="identifier">search_CM</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Colonies::find</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">search_CM</span><span class="plain">) {</span>
                <span class="reserved">module</span><span class="plain"> *</span><span class="identifier">found_M</span><span class="plain"> = </span><span class="functiontext"><a href="#SP8">Colonies::as_module</a></span><span class="plain">(</span><span class="identifier">search_CM</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">Wm</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">found_M</span><span class="plain">) {</span>
                    <span class="identifier">search_M</span><span class="plain"> = </span><span class="identifier">found_M</span><span class="plain">;</span>
                    <span class="identifier">text</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
                    <span class="identifier">external</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10">&#167;10</a>.</p>

<p class="inwebparagraph"><a id="SP10_3"></a><b>&#167;10.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Is it the name of a function in the current web?</span> <span class="cwebmacronumber">10.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">language_function</span><span class="plain"> *</span><span class="identifier">fn</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">fn</span><span class="plain">, </span><span class="reserved">language_function</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq_insensitive</a></span><span class="plain">(</span><span class="identifier">fn</span><span class="plain">-&gt;</span><span class="element">function_name</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">)) {</span>
                <span class="functiontext"><a href="#SP11">Colonies::paragraph_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">fn</span><span class="plain">-&gt;</span><span class="identifier">function_header_at</span><span class="plain">-&gt;</span><span class="element">owning_paragraph</span><span class="plain">,</span>
                    <span class="identifier">L</span><span class="plain">-&gt;</span><span class="element">owning_section</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">);</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">fn</span><span class="plain">-&gt;</span><span class="element">function_name</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10">&#167;10</a>.</p>

<p class="inwebparagraph"><a id="SP10_4"></a><b>&#167;10.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Is it the name of a type in the current web?</span> <span class="cwebmacronumber">10.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">language_type</span><span class="plain"> *</span><span class="identifier">str</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">str</span><span class="plain">, </span><span class="reserved">language_type</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq_insensitive</a></span><span class="plain">(</span><span class="identifier">str</span><span class="plain">-&gt;</span><span class="element">structure_name</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">)) {</span>
                <span class="functiontext"><a href="#SP11">Colonies::paragraph_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">str</span><span class="plain">-&gt;</span><span class="element">structure_header_at</span><span class="plain">-&gt;</span><span class="element">owning_paragraph</span><span class="plain">,</span>
                    <span class="identifier">L</span><span class="plain">-&gt;</span><span class="element">owning_section</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">);</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">str</span><span class="plain">-&gt;</span><span class="element">structure_name</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10">&#167;10</a>.</p>

<p class="inwebparagraph"><a id="SP10_5"></a><b>&#167;10.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">It refers unambiguously to a single section</span> <span class="cwebmacronumber">10.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">found_M</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"could not locate M"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">search_CM</span><span class="plain">) </span>&lt;<span class="cwebmacro">The section is a known colony member</span> <span class="cwebmacronumber">10.5.1</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span>&lt;<span class="cwebmacro">The section is not in a known colony member</span> <span class="cwebmacronumber">10.5.2</span>&gt;<span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10">&#167;10</a>, <a href="#SP10_1">&#167;10.1</a>.</p>

<p class="inwebparagraph"><a id="SP10_5_1"></a><b>&#167;10.5.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The section is a known colony member</span> <span class="cwebmacronumber">10.5.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">from</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP6">Filenames::get_path_to</a></span><span class="plain">(</span><span class="identifier">for_HTML_file</span><span class="plain">);</span>
        <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">to</span><span class="plain"> = </span><span class="identifier">search_CM</span><span class="plain">-&gt;</span><span class="element">weave_path</span><span class="plain">;</span>
        <span class="functiontext"><a href="3-pth.html#SP8">Pathnames::relative_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">to</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">bare_module_name</span><span class="plain">) </span><span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">search_CM</span><span class="plain">-&gt;</span><span class="element">home_leaf</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">found_Sm</span><span class="plain">) </span><span class="functiontext"><a href="#SP11">Colonies::section_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">found_Sm</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">bare_module_name</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="string">" (in %S)"</span><span class="plain">, </span><span class="identifier">search_CM</span><span class="plain">-&gt;</span><span class="element">name</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10_5">&#167;10.5</a>.</p>

<p class="inwebparagraph"><a id="SP10_5_2"></a><b>&#167;10.5.2.  </b>In the absence of a colony file, Inweb can really only guess, and the
guess it makes is that modules of the current web will be woven alongside
the main one, and suffixed by <code class="display"><span class="extract">-module</span></code>.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">The section is not in a known colony member</span> <span class="cwebmacronumber">10.5.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">found_M</span><span class="plain"> == </span><span class="identifier">from_M</span><span class="plain">) {</span>
            <span class="functiontext"><a href="#SP11">Colonies::section_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">found_Sm</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="string">"../%S-module/"</span><span class="plain">, </span><span class="identifier">found_M</span><span class="plain">-&gt;</span><span class="element">module_name</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP11">Colonies::section_URL</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">found_Sm</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">bare_module_name</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">)</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="string">" (in %S)"</span><span class="plain">, </span><span class="identifier">found_M</span><span class="plain">-&gt;</span><span class="element">module_name</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP10_5">&#167;10.5</a>.</p>

<p class="inwebparagraph"><a id="SP11"></a><b>&#167;11. URL management. </b></p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::link_URL<button class="popup" onclick="togglePopup('usagePopup370')">...<span class="popuptext" id="usagePopup370">Usage of <b>Colonies::link_URL</b>:<br><a href="#SP6">&#167;6</a>, The Indexer - <a href="3-ti.html#SP6_1_8_14">&#167;6.1.8.14</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">link_text</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">link_text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *//(%c+)// *"</span><span class="plain">))</span>
            <span class="functiontext"><a href="#SP11">Colonies::reference_URL</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">F</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">link_text</span><span class="plain">);</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::reference_URL<button class="popup" onclick="togglePopup('usagePopup371')">...<span class="popuptext" id="usagePopup371">Usage of <b>Colonies::reference_URL</b>:<br>The Indexer - <a href="3-ti.html#SP6_1_8_11">&#167;6.1.8.11</a>, <a href="3-ti.html#SP6_1_8_13">&#167;6.1.8.13</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">link_text</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">) {</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">url</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="#SP10">Colonies::resolve_reference_in_weave</a></span><span class="plain">(</span><span class="identifier">url</span><span class="plain">, </span><span class="identifier">title</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="identifier">link_text</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">))</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">url</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Warning: unable to resolve reference '%S' in navigation\n"</span><span class="plain">, </span><span class="identifier">link_text</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">url</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::section_URL<button class="popup" onclick="togglePopup('usagePopup372')">...<span class="popuptext" id="usagePopup372">Usage of <b>Colonies::section_URL</b>:<br><a href="#SP10_5_1">&#167;10.5.1</a>, <a href="#SP10_5_2">&#167;10.5.2</a>, The Indexer - <a href="3-ti.html#SP6_1_8_8_1">&#167;6.1.8.8.1</a><br>HTML Formats - <a href="5-hf.html#SP28">&#167;28</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">section_md</span><span class="plain"> *</span><span class="identifier">Sm</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Sm</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"unwoven section"</span><span class="plain">);</span>
        <span class="identifier">LOOP_THROUGH_TEXT</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">, </span><span class="identifier">Sm</span><span class="plain">-&gt;</span><span class="element">sect_range</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'/'</span><span class="plain">) || (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">' '</span><span class="plain">))</span>
                <span class="identifier">PUT</span><span class="plain">(</span><span class="character">'-'</span><span class="plain">);</span>
            <span class="reserved">else</span>
                <span class="identifier">PUT</span><span class="plain">(</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">));</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">".html"</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Colonies::paragraph_URL<button class="popup" onclick="togglePopup('usagePopup373')">...<span class="popuptext" id="usagePopup373">Usage of <b>Colonies::paragraph_URL</b>:<br><a href="#SP10_3">&#167;10.3</a>, <a href="#SP10_4">&#167;10.4</a>, HTML Formats - <a href="5-hf.html#SP7">&#167;7</a>, <a href="5-hf.html#SP8">&#167;8</a>, <a href="5-hf.html#SP9_3">&#167;9.3</a>, <a href="5-hf.html#SP27">&#167;27</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">paragraph</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain">, </span><span class="reserved">section</span><span class="plain"> *</span><span class="identifier">from</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">a_link</span><span class="plain">) {</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">linkto</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">from</span><span class="plain">) &amp;&amp; (</span><span class="identifier">P</span><span class="plain">-&gt;</span><span class="element">under_section</span><span class="plain"> != </span><span class="identifier">from</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">linkto</span><span class="plain">, </span><span class="identifier">P</span><span class="plain">-&gt;</span><span class="element">under_section</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">-&gt;</span><span class="element">sect_range</span><span class="plain">);</span>
            <span class="identifier">LOOP_THROUGH_TEXT</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">, </span><span class="identifier">linkto</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'/'</span><span class="plain">) || (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">' '</span><span class="plain">))</span>
                    <span class="functiontext"><a href="4-sm.html#SP14">Str::put</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">, </span><span class="character">'-'</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">linkto</span><span class="plain">, </span><span class="string">".html"</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">linkto</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">P</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%s%S"</span><span class="plain">, (</span><span class="identifier">a_link</span><span class="plain">)?</span><span class="string">"#"</span><span class="plain">:</span><span class="string">""</span><span class="plain">, </span><span class="identifier">P</span><span class="plain">-&gt;</span><span class="element">ornament</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">linkto</span><span class="plain">);</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">P</span><span class="plain">) {</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"P"</span><span class="plain">);</span>
            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">N</span><span class="plain"> = </span><span class="identifier">P</span><span class="plain">-&gt;</span><span class="element">paragraph_number</span><span class="plain">;</span>
            <span class="identifier">LOOP_THROUGH_TEXT</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'.'</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"_"</span><span class="plain">);</span>
                <span class="reserved">else</span><span class="plain"> </span><span class="identifier">PUT</span><span class="plain">(</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">));</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><a href="6-rw.html">Back to 'Readme Writeme'</a></li><li><i>(This section ends Chapter 6: Extras.)</i></li></ul><hr class="tocbar">
<!--End of weave-->
<script src="http://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script type="text/javascript">
		(function() {
  (function($) {
    return $.bigfoot = function(options) {
      var addBreakpoint, baseFontSize, bigfoot, buttonHover, calculatePixelDimension, cleanFootnoteLinks, clickButton, createPopover, defaults, deleteEmptyOrHR, escapeKeypress, footnoteInit, getSetting, makeDefaultCallbacks, popoverStates, positionTooltip, removeBackLinks, removeBreakpoint, removePopovers, replaceWithReferenceAttributes, repositionFeet, roomCalc, settings, touchClick, unhoverFeet, updateSetting, viewportDetails;
      bigfoot = void 0;
      defaults = {
        actionOriginalFN: "hide",
        activateCallback: function() {},
        activateOnHover: false,
        allowMultipleFN: false,
        anchorPattern: /(fn|footnote|note)[:\-_\d]/gi,
        anchorParentTagname: 'sup',
        breakpoints: {},
        deleteOnUnhover: false,
        footnoteParentClass: 'footnote',
        footnoteTagname: 'li',
        hoverDelay: 250,
        numberResetSelector: void 0,
        popoverDeleteDelay: 300,
        popoverCreateDelay: 100,
        positionContent: true,
        preventPageScroll: true,
        scope: false,
        useFootnoteOnlyOnce: true,
        contentMarkup: "<aside class=\"bigfoot-footnote is-positioned-bottom\" data-footnote-number=\"{{FOOTNOTENUM}}\" data-footnote-identifier=\"{{FOOTNOTEID}}\" alt=\"Footnote {{FOOTNOTENUM}}\"> <div class=\"bigfoot-footnote__wrapper\"> <div class=\"bigfoot-footnote__content\"> {{FOOTNOTECONTENT}} </div></div> <div class=\"bigfoot-footnote__tooltip\"></div> </aside>",
        buttonMarkup: "<div class='bigfoot-footnote__container'> <button class=\"bigfoot-footnote__button\" id=\"{{SUP:data-footnote-backlink-ref}}\" data-footnote-number=\"{{FOOTNOTENUM}}\" data-footnote-identifier=\"{{FOOTNOTEID}}\" alt=\"See Footnote {{FOOTNOTENUM}}\" rel=\"footnote\" data-bigfoot-footnote=\"{{FOOTNOTECONTENT}}\"> <svg class=\"bigfoot-footnote__button__circle\" viewbox=\"0 0 6 6\" preserveAspectRatio=\"xMinYMin\"><circle r=\"3\" cx=\"3\" cy=\"3\" fill=\"white\"></circle></svg> <svg class=\"bigfoot-footnote__button__circle\" viewbox=\"0 0 6 6\" preserveAspectRatio=\"xMinYMin\"><circle r=\"3\" cx=\"3\" cy=\"3\" fill=\"white\"></circle></svg> <svg class=\"bigfoot-footnote__button__circle\" viewbox=\"0 0 6 6\" preserveAspectRatio=\"xMinYMin\"><circle r=\"3\" cx=\"3\" cy=\"3\" fill=\"white\"></circle></svg> </button></div>"
      };
      settings = $.extend(defaults, options);
      popoverStates = {};
      footnoteInit = function() {
        var $curResetElement, $currentLastFootnoteLink, $footnoteAnchors, $footnoteButton, $lastResetElement, $parent, $relevantFNLink, $relevantFootnote, finalFNLinks, footnoteButton, footnoteButtonSearchQuery, footnoteContent, footnoteIDNum, footnoteLinks, footnoteNum, footnotes, i, _i, _ref, _results;
        footnoteButtonSearchQuery = settings.scope ? "" + settings.scope + " a[href*=\"#\"]" : "a[href*=\"#\"]";
        $footnoteAnchors = $(footnoteButtonSearchQuery).filter(function() {
          var $this, relAttr;
          $this = $(this);
          relAttr = $this.attr("rel");
          if (relAttr === "null" || (relAttr == null)) {
            relAttr = "";
          }
          return ("" + ($this.attr("href")) + relAttr).match(settings.anchorPattern) && $this.closest("[class*=" + settings.footnoteParentClass + "]:not(a):not(" + settings.anchorParentTagname + ")").length < 1;
        });
        footnotes = [];
        footnoteLinks = [];
        finalFNLinks = [];
        cleanFootnoteLinks($footnoteAnchors, footnoteLinks);
        $(footnoteLinks).each(function() {
          var $closestFootnoteEl, relatedFN;
          relatedFN = $(this).data("footnote-ref").replace(/[:.+~*\]\[]/g, "\\$&");
          if (settings.useFootnoteOnlyOnce) {
            relatedFN = "" + relatedFN + ":not(.footnote-processed)";
          }
          $closestFootnoteEl = $(relatedFN).closest(settings.footnoteTagname);
          if ($closestFootnoteEl.length > 0) {
            footnotes.push($closestFootnoteEl.first().addClass("footnote-processed"));
            return finalFNLinks.push(this);
          }
        });
        $currentLastFootnoteLink = $("[data-footnote-identifier]:last");
        footnoteIDNum = $currentLastFootnoteLink.length < 1 ? 0 : +$currentLastFootnoteLink.data("footnote-identifier");
        _results = [];
        for (i = _i = 0, _ref = footnotes.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          footnoteContent = removeBackLinks($(footnotes[i]).html().trim(), $(finalFNLinks[i]).data("footnote-backlink-ref"));
          footnoteContent = footnoteContent.replace(/"/g, "&quot;").replace(/&lt;/g, "&ltsym;").replace(/&gt;/g, "&gtsym;");
          footnoteIDNum += 1;
          footnoteButton = "";
          $relevantFNLink = $(finalFNLinks[i]);
          $relevantFootnote = $(footnotes[i]);
          if (settings.numberResetSelector != null) {
            $curResetElement = $relevantFNLink.closest(settings.numberResetSelector);
            if ($curResetElement.is($lastResetElement)) {
              footnoteNum += 1;
            } else {
              footnoteNum = 1;
            }
            $lastResetElement = $curResetElement;
          } else {
            footnoteNum = footnoteIDNum;
          }
          if (footnoteContent.indexOf("<") !== 0) {
            footnoteContent = "<p>" + footnoteContent + "</p>";
          }
          footnoteButton = settings.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g, footnoteNum).replace(/\{\{FOOTNOTEID\}\}/g, footnoteIDNum).replace(/\{\{FOOTNOTECONTENT\}\}/g, footnoteContent);
          footnoteButton = replaceWithReferenceAttributes(footnoteButton, "SUP", $relevantFNLink);
          footnoteButton = replaceWithReferenceAttributes(footnoteButton, "FN", $relevantFootnote);
          $footnoteButton = $(footnoteButton).insertBefore($relevantFNLink);
          $parent = $relevantFootnote.parent();
          switch (settings.actionOriginalFN.toLowerCase()) {
            case "hide":
              $relevantFNLink.addClass("footnote-print-only");
              $relevantFootnote.addClass("footnote-print-only");
              _results.push(deleteEmptyOrHR($parent));
              break;
            case "delete":
              $relevantFNLink.remove();
              $relevantFootnote.remove();
              _results.push(deleteEmptyOrHR($parent));
              break;
            default:
              _results.push($relevantFNLink.addClass("footnote-print-only"));
          }
        }
        return _results;
      };
      cleanFootnoteLinks = function($footnoteAnchors, footnoteLinks) {
        var $parent, $supChild, linkHREF, linkID;
        if (footnoteLinks == null) {
          footnoteLinks = [];
        }
        $parent = void 0;
        $supChild = void 0;
        linkHREF = void 0;
        linkID = void 0;
        $footnoteAnchors.each(function() {
          var $child, $this;
          $this = $(this);
          linkHREF = "#" + ($this.attr("href")).split("#")[1];
          $parent = $this.closest(settings.anchorParentTagname);
          $child = $this.find(settings.anchorParentTagname);
          if ($parent.length > 0) {
            linkID = ($parent.attr("id") || "") + ($this.attr("id") || "");
            return footnoteLinks.push($parent.attr({
              "data-footnote-backlink-ref": linkID,
              "data-footnote-ref": linkHREF
            }));
          } else if ($child.length > 0) {
            linkID = ($child.attr("id") || "") + ($this.attr("id") || "");
            return footnoteLinks.push($this.attr({
              "data-footnote-backlink-ref": linkID,
              "data-footnote-ref": linkHREF
            }));
          } else {
            linkID = $this.attr("id") || "";
            return footnoteLinks.push($this.attr({
              "data-footnote-backlink-ref": linkID,
              "data-footnote-ref": linkHREF
            }));
          }
        });
      };
      deleteEmptyOrHR = function($el) {
        var $parent;
        $parent = void 0;
        if ($el.is(":empty") || $el.children(":not(.footnote-print-only)").length === 0) {
          $parent = $el.parent();
          if (settings.actionOriginalFN.toLowerCase() === "delete") {
            $el.remove();
          } else {
            $el.addClass("footnote-print-only");
          }
          return deleteEmptyOrHR($parent);
        } else if ($el.children(":not(.footnote-print-only)").length === $el.children("hr:not(.footnote-print-only)").length) {
          $parent = $el.parent();
          if (settings.actionOriginalFN.toLowerCase() === "delete") {
            $el.remove();
          } else {
            $el.children("hr").addClass("footnote-print-only");
            $el.addClass("footnote-print-only");
          }
          return deleteEmptyOrHR($parent);
        }
      };
      removeBackLinks = function(footnoteHTML, backlinkID) {
        var regex;
        if (backlinkID.indexOf(' ') >= 0) {
          backlinkID = backlinkID.trim().replace(/\s+/g, "|").replace(/(.*)/g, "($1)");
        }
        regex = new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#" + backlinkID + "[^>]*>(.*?)<\\s*/\\s*a>", "g");
        return footnoteHTML.replace(regex, "").replace("[]", "");
      };
      replaceWithReferenceAttributes = function(string, referenceKeyword, $referenceElement) {
        var refMatches, refRegex, refReplaceRegex, refReplaceText;
        refRegex = new RegExp("\\{\\{" + referenceKeyword + ":([^\\}]*)\\}\\}", "g");
        refMatches = void 0;
        refReplaceText = void 0;
        refReplaceRegex = void 0;
        refMatches = refRegex.exec(string);
        while (refMatches) {
          if (refMatches[1]) {
            refReplaceText = $referenceElement.attr(refMatches[1]) || "";
            string = string.replace("{{" + referenceKeyword + ":" + refMatches[1] + "}}", refReplaceText);
          }
          refMatches = refRegex.exec(string);
        }
        return string;
      };
      buttonHover = function(event) {
        var $buttonHovered, dataIdentifier, otherPopoverSelector;
        if (settings.activateOnHover) {
          $buttonHovered = $(event.target).closest(".bigfoot-footnote__button");
          dataIdentifier = "[data-footnote-identifier=\"" + ($buttonHovered.attr("data-footnote-identifier")) + "\"]";
          if ($buttonHovered.hasClass("is-active")) {
            return;
          }
          $buttonHovered.addClass("is-hover-instantiated");
          if (!settings.allowMultipleFN) {
            otherPopoverSelector = ".bigfoot-footnote:not(" + dataIdentifier + ")";
            removePopovers(otherPopoverSelector);
          }
          createPopover(".bigfoot-footnote__button" + dataIdentifier).addClass("is-hover-instantiated");
        }
      };
      touchClick = function(event) {
        var $nearButton, $nearFootnote, $target;
        $target = $(event.target);
        $nearButton = $target.closest(".bigfoot-footnote__button");
        $nearFootnote = $target.closest(".bigfoot-footnote");
        if ($nearButton.length > 0) {
          event.preventDefault();
          clickButton($nearButton);
        } else if ($nearFootnote.length < 1) {
          if ($(".bigfoot-footnote").length > 0) {
            removePopovers();
          }
        }
      };
      clickButton = function($button) {
        var dataIdentifier;
        $button.blur();
        dataIdentifier = "data-footnote-identifier=\"" + ($button.attr("data-footnote-identifier")) + "\"";
        if ($button.hasClass("changing")) {
          return;
        } else if (!$button.hasClass("is-active")) {
          $button.addClass("changing");
          setTimeout((function() {
            return $button.removeClass("changing");
          }), settings.popoverCreateDelay);
          createPopover(".bigfoot-footnote__button[" + dataIdentifier + "]");
          $button.addClass("is-click-instantiated");
          if (!settings.allowMultipleFN) {
            removePopovers(".bigfoot-footnote:not([" + dataIdentifier + "])");
          }
        } else {
          if (!settings.allowMultipleFN) {
            removePopovers();
          } else {
            removePopovers(".bigfoot-footnote[" + dataIdentifier + "]");
          }
        }
      };
      createPopover = function(selector) {
        var $buttons, $popoversCreated;
        $buttons = void 0;
        if (typeof selector !== "string" && settings.allowMultipleFN) {
          $buttons = selector;
        } else if (typeof selector !== "string") {
          $buttons = selector.first();
        } else if (settings.allowMultipleFN) {
          $buttons = $(selector).closest(".bigfoot-footnote__button");
        } else {
          $buttons = $(selector + ":first").closest(".bigfoot-footnote__button");
        }
        $popoversCreated = $();
        $buttons.each(function() {
          var $content, $contentContainer, $this, content;
          $this = $(this);
          content = void 0;
          try {
            content = settings.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g, $this.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g, $this.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g, $this.attr("data-bigfoot-footnote")).replace(/\&gtsym\;/g, "&gt;").replace(/\&ltsym\;/g, "&lt;");
            return content = replaceWithReferenceAttributes(content, "BUTTON", $this);
          } finally {
            $content = $(content);
            try {
              settings.activateCallback($content, $this);
            } catch (_error) {}
            $content.insertAfter($buttons);
            popoverStates[$this.attr("data-footnote-identifier")] = "init";
            $content.attr("bigfoot-max-width", calculatePixelDimension($content.css("max-width"), $content));
            $content.css("max-width", 10000);
            $contentContainer = $content.find(".bigfoot-footnote__content");
            $content.attr("data-bigfoot-max-height", calculatePixelDimension($contentContainer.css("max-height"), $contentContainer));
            repositionFeet();
            $this.addClass("is-active");
            $content.find(".bigfoot-footnote__content").bindScrollHandler();
            $popoversCreated = $popoversCreated.add($content);
          }
        });
        setTimeout((function() {
          return $popoversCreated.addClass("is-active");
        }), settings.popoverCreateDelay);
        return $popoversCreated;
      };
      baseFontSize = function() {
        var el, size;
        el = document.createElement("div");
        el.style.cssText = "display:inline-block;padding:0;line-height:1;position:absolute;visibility:hidden;font-size:1em;";
        el.appendChild(document.createElement("M"));
        document.body.appendChild(el);
        size = el.offsetHeight;
        document.body.removeChild(el);
        return size;
      };
      calculatePixelDimension = function(dim, $el) {
        if (dim === "none") {
          dim = 10000;
        } else if (dim.indexOf("rem") >= 0) {
          dim = parseFloat(dim) * baseFontSize();
        } else if (dim.indexOf("em") >= 0) {
          dim = parseFloat(dim) * parseFloat($el.css("font-size"));
        } else if (dim.indexOf("px") >= 0) {
          dim = parseFloat(dim);
          if (dim <= 60) {
            dim = dim / parseFloat($el.parent().css("width"));
          }
        } else if (dim.indexOf("%") >= 0) {
          dim = parseFloat(dim) / 100;
        }
        return dim;
      };
      $.fn.bindScrollHandler = function() {
        if (!settings.preventPageScroll) {
          return $(this);
        }
        $(this).on("DOMMouseScroll mousewheel", function(event) {
          var $popover, $this, delta, height, prevent, scrollHeight, scrollTop, up;
          $this = $(this);
          scrollTop = $this.scrollTop();
          scrollHeight = $this[0].scrollHeight;
          height = parseInt($this.css("height"));
          $popover = $this.closest(".bigfoot-footnote");
          if ($this.scrollTop() > 0 && $this.scrollTop() < 10) {
            $popover.addClass("is-scrollable");
          }
          if (!$popover.hasClass("is-scrollable")) {
            return;
          }
          delta = event.type === "DOMMouseScroll" ? event.originalEvent.detail * -40 : event.originalEvent.wheelDelta;
          up = delta > 0;
          prevent = function() {
            event.stopPropagation();
            event.preventDefault();
            event.returnValue = false;
            return false;
          };
          if (!up && -delta > scrollHeight - height - scrollTop) {
            $this.scrollTop(scrollHeight);
            $popover.addClass("is-fully-scrolled");
            return prevent();
          } else if (up && delta > scrollTop) {
            $this.scrollTop(0);
            $popover.removeClass("is-fully-scrolled");
            return prevent();
          } else {
            return $popover.removeClass("is-fully-scrolled");
          }
        });
        return $(this);
      };
      unhoverFeet = function(e) {
        if (settings.deleteOnUnhover && settings.activateOnHover) {
          return setTimeout((function() {
            var $target;
            $target = $(e.target).closest(".bigfoot-footnote, .bigfoot-footnote__button");
            if ($(".bigfoot-footnote__button:hover, .bigfoot-footnote:hover").length < 1) {
              return removePopovers();
            }
          }), settings.hoverDelay);
        }
      };
      escapeKeypress = function(event) {
        if (event.keyCode === 27) {
          return removePopovers();
        }
      };
      removePopovers = function(footnotes, timeout) {
        var $buttonsClosed, $linkedButton, $this, footnoteID;
        if (footnotes == null) {
          footnotes = ".bigfoot-footnote";
        }
        if (timeout == null) {
          timeout = settings.popoverDeleteDelay;
        }
        $buttonsClosed = $();
        footnoteID = void 0;
        $linkedButton = void 0;
        $this = void 0;
        $(footnotes).each(function() {
          $this = $(this);
          footnoteID = $this.attr("data-footnote-identifier");
          $linkedButton = $(".bigfoot-footnote__button[data-footnote-identifier=\"" + footnoteID + "\"]");
          if (!$linkedButton.hasClass("changing")) {
            $buttonsClosed = $buttonsClosed.add($linkedButton);
            $linkedButton.removeClass("is-active is-hover-instantiated is-click-instantiated").addClass("changing");
            $this.removeClass("is-active").addClass("disapearing");
            return setTimeout((function() {
              $this.remove();
              delete popoverStates[footnoteID];
              return $linkedButton.removeClass("changing");
            }), timeout);
          }
        });
        return $buttonsClosed;
      };
      repositionFeet = function(e) {
        var type;
        if (settings.positionContent) {
          type = e ? e.type : "resize";
          $(".bigfoot-footnote").each(function() {
            var $button, $contentWrapper, $mainWrap, $this, dataIdentifier, identifier, lastState, marginSize, maxHeightInCSS, maxHeightOnScreen, maxWidth, maxWidthInCSS, positionOnTop, relativeToWidth, roomLeft, totalHeight;
            $this = $(this);
            identifier = $this.attr("data-footnote-identifier");
            dataIdentifier = "data-footnote-identifier=\"" + identifier + "\"";
            $contentWrapper = $this.find(".bigfoot-footnote__content");
            $button = $this.siblings(".bigfoot-footnote__button");
            roomLeft = roomCalc($button);
            marginSize = parseFloat($this.css("margin-top"));
            maxHeightInCSS = +($this.attr("data-bigfoot-max-height"));
            totalHeight = 2 * marginSize + $this.outerHeight();
            maxHeightOnScreen = 10000;
            positionOnTop = roomLeft.bottomRoom < totalHeight && roomLeft.topRoom > roomLeft.bottomRoom;
            lastState = popoverStates[identifier];
            if (positionOnTop) {
              if (lastState !== "top") {
                popoverStates[identifier] = "top";
                $this.addClass("is-positioned-top").removeClass("is-positioned-bottom");
                $this.css("transform-origin", (roomLeft.leftRelative * 100) + "% 100%");
              }
              maxHeightOnScreen = roomLeft.topRoom - marginSize - 15;
            } else {
              if (lastState !== "bottom" || lastState === "init") {
                popoverStates[identifier] = "bottom";
                $this.removeClass("is-positioned-top").addClass("is-positioned-bottom");
                $this.css("transform-origin", (roomLeft.leftRelative * 100) + "% 0%");
              }
              maxHeightOnScreen = roomLeft.bottomRoom - marginSize - 15;
            }
            $this.find(".bigfoot-footnote__content").css({
              "max-height": Math.min(maxHeightOnScreen, maxHeightInCSS) + "px"
            });
            if (type === "resize") {
              maxWidthInCSS = parseFloat($this.attr("bigfoot-max-width"));
              $mainWrap = $this.find(".bigfoot-footnote__wrapper");
              maxWidth = maxWidthInCSS;
              if (maxWidthInCSS <= 1) {
                relativeToWidth = (function() {
                  var jq, userSpecifiedRelativeElWidth;
                  userSpecifiedRelativeElWidth = 10000;
                  if (settings.maxWidthRelativeTo) {
                    jq = $(settings.maxWidthRelativeTo);
                    if (jq.length > 0) {
                      userSpecifiedRelativeElWidth = jq.outerWidth();
                    }
                  }
                  return Math.min(window.innerWidth, userSpecifiedRelativeElWidth);
                })();
                maxWidth = relativeToWidth * maxWidthInCSS;
              }
              maxWidth = Math.min(maxWidth, $this.find(".bigfoot-footnote__content").outerWidth() + 1);
              $mainWrap.css("max-width", maxWidth + "px");
              $this.css({
                left: (-roomLeft.leftRelative * maxWidth + parseFloat($button.css("margin-left")) + $button.outerWidth() / 2) + "px"
              });
              positionTooltip($this, roomLeft.leftRelative);
            }
            if (parseInt($this.outerHeight()) < $this.find(".bigfoot-footnote__content")[0].scrollHeight) {
              return $this.addClass("is-scrollable");
            }
          });
        }
      };
      positionTooltip = function($popover, leftRelative) {
        var $tooltip;
        if (leftRelative == null) {
          leftRelative = 0.5;
        }
        $tooltip = $popover.find(".bigfoot-footnote__tooltip");
        if ($tooltip.length > 0) {
          $tooltip.css("left", "" + (leftRelative * 100) + "%");
        }
      };
      roomCalc = function($el) {
        var elHeight, elLeftMargin, elWidth, leftRoom, topRoom, w;
        elLeftMargin = parseFloat($el.css("margin-left"));
        elWidth = parseFloat($el.outerWidth()) - elLeftMargin;
        elHeight = parseFloat($el.outerHeight());
        w = viewportDetails();
        topRoom = $el.offset().top - w.scrollY + elHeight / 2;
        leftRoom = $el.offset().left - w.scrollX + elWidth / 2;
        return {
          topRoom: topRoom,
          bottomRoom: w.height - topRoom,
          leftRoom: leftRoom,
          rightRoom: w.width - leftRoom,
          leftRelative: leftRoom / w.width,
          topRelative: topRoom / w.height
        };
      };
      viewportDetails = function() {
        var $window;
        $window = $(window);
        return {
          width: window.innerWidth,
          height: window.innerHeight,
          scrollX: $window.scrollLeft(),
          scrollY: $window.scrollTop()
        };
      };
      addBreakpoint = function(size, trueCallback, falseCallback, deleteDelay, removeOpen) {
        var falseDefaultPositionSetting, minMax, mqListener, mql, query, s, trueDefaultPositionSetting;
        if (deleteDelay == null) {
          deleteDelay = settings.popoverDeleteDelay;
        }
        if (removeOpen == null) {
          removeOpen = true;
        }
        mql = void 0;
        minMax = void 0;
        s = void 0;
        if (typeof size === "string") {
          s = size.toLowerCase() === "iphone" ? "<320px" : size.toLowerCase() === "ipad" ? "<768px" : size;
          minMax = s.charAt(0) === ">" ? "min" : s.charAt(0) === "<" ? "max" : null;
          query = minMax ? "(" + minMax + "-width: " + (s.substring(1)) + ")" : s;
          mql = window.matchMedia(query);
        } else {
          mql = size;
        }
        if (mql.media && mql.media === "invalid") {
          return {
            added: false,
            mq: mql,
            listener: null
          };
        }
        trueDefaultPositionSetting = minMax === "min";
        falseDefaultPositionSetting = minMax === "max";
        trueCallback = trueCallback || makeDefaultCallbacks(removeOpen, deleteDelay, trueDefaultPositionSetting, function($popover) {
          return $popover.addClass("is-bottom-fixed");
        });
        falseCallback = falseCallback || makeDefaultCallbacks(removeOpen, deleteDelay, falseDefaultPositionSetting, function() {});
        mqListener = function(mq) {
          if (mq.matches) {
            trueCallback(removeOpen, bigfoot);
          } else {
            falseCallback(removeOpen, bigfoot);
          }
        };
        mql.addListener(mqListener);
        mqListener(mql);
        settings.breakpoints[size] = {
          added: true,
          mq: mql,
          listener: mqListener
        };
        return settings.breakpoints[size];
      };
      makeDefaultCallbacks = function(removeOpen, deleteDelay, position, callback) {
        return function(removeOpen, bigfoot) {
          var $closedPopovers;
          $closedPopovers = void 0;
          if (removeOpen) {
            $closedPopovers = bigfoot.close();
            bigfoot.updateSetting("activateCallback", callback);
          }
          return setTimeout((function() {
            bigfoot.updateSetting("positionContent", position);
            if (removeOpen) {
              return bigfoot.activate($closedPopovers);
            }
          }), deleteDelay);
        };
      };
      removeBreakpoint = function(target, callback) {
        var b, breakpoint, mq, mqFound;
        mq = null;
        b = void 0;
        mqFound = false;
        if (typeof target === "string") {
          mqFound = settings.breakpoints[target] !== undefined;
        } else {
          for (b in settings.breakpoints) {
            if (settings.breakpoints.hasOwnProperty(b) && settings.breakpoints[b].mq === target) {
              mqFound = true;
            }
          }
        }
        if (mqFound) {
          breakpoint = settings.breakpoints[b || target];
          if (callback) {
            callback({
              matches: false
            });
          } else {
            breakpoint.listener({
              matches: false
            });
          }
          breakpoint.mq.removeListener(breakpoint.listener);
          delete settings.breakpoints[b || target];
        }
        return mqFound;
      };
      updateSetting = function(newSettings, value) {
        var oldValue, prop;
        oldValue = void 0;
        if (typeof newSettings === "string") {
          oldValue = settings[newSettings];
          settings[newSettings] = value;
        } else {
          oldValue = {};
          for (prop in newSettings) {
            if (newSettings.hasOwnProperty(prop)) {
              oldValue[prop] = settings[prop];
              settings[prop] = newSettings[prop];
            }
          }
        }
        return oldValue;
      };
      getSetting = function(setting) {
        return settings[setting];
      };
      $(document).ready(function() {
        footnoteInit();
        $(document).on("mouseenter", ".bigfoot-footnote__button", buttonHover);
        $(document).on("touchend click", touchClick);
        $(document).on("mouseout", ".is-hover-instantiated", unhoverFeet);
        $(document).on("keyup", escapeKeypress);
        $(window).on("scroll resize", repositionFeet);
        return $(document).on("gestureend", function() {
          return repositionFeet();
        });
      });
      bigfoot = {
        removePopovers: removePopovers,
        close: removePopovers,
        createPopover: createPopover,
        activate: createPopover,
        repositionFeet: repositionFeet,
        reposition: repositionFeet,
        addBreakpoint: addBreakpoint,
        removeBreakpoint: removeBreakpoint,
        getSetting: getSetting,
        updateSetting: updateSetting
      };
      return bigfoot;
    };
  })(jQuery);

}).call(this);

		</script>
		<script type="text/javascript">
    $.bigfoot();
</script>

<link href="Bigfoot.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

