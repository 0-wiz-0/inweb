<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>How This Program Works</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Octagram184x184.png" width=72 height=72">
</a></h1>
<ul><li><a href="index.html"><span class="selectedlink">inweb</span></a></li>
</ul><h2>Foundation Module</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb">github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="../../../inform/docs/index.html">inform</a></li>
<li><a href="../../../intest/docs/index.html">intest</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'How This Program Works' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">inweb</a></li><li><a href="index.html#P">Preliminaries</a></li><li><b>How This Program Works</b></li></ul><p class="purpose">An overview of how Inweb works, with links to all of its important functions.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. How to read this web</a></li><li><a href="#SP2">&#167;2. Basics of using Foundation</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. How to read this web. </b>Inweb is a program for weaving and tangling literate programs, or "webs",
and it is a web itself. Webs are easy to read, which is really the point
of them, but they take getting used to, and it may be easiest to begin by
skimming the two (deliberately minimal) examples here, <a href="../goldbach/index.html" class="internal">goldbach</a> and
<a href="../twinprimes/twinprimes.html" class="internal">twinprimes</a>.
</p>

<p class="inwebparagraph">Inweb is a command-line program written in a modest extension of C. See
<a href="M-tid.html" class="internal">The InC Dialect</a> for full details, but essentially: it's C without
function predeclarations or header files, and where functions are organised
into namespaces, having names like <code class="display"><span class="extract">Parser::begin()</span></code> rather than just <code class="display"><span class="extract">begin()</span></code>.
</p>

<p class="inwebparagraph">Programs like Inweb are divided into "modules", each of which is a web in its
own right. Inweb has two: the main part of the program, and a library of
utility functions called Foundation.
</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Basics of using Foundation. </b>Foundation provides Unicode text, lists, memory management, file handling,
regular expression matching, dictionaries of key-value pairs, and so on.
See <a href="../foundation-module/1-fm.html" class="internal">the foundation module</a> to read it as a web, but you shouldn't need to.
</p>

<p class="inwebparagraph">To a limited extent, Foundation enables C programs like Inweb to have "objects"
and "methods". For example, Inweb has a concept of "weave plugins", and these
are identified (by reference) using values of type <code class="display"><span class="extract">weave_plugin *</span></code>. The
relevant section of the Inweb source defines the type <a href="5-wp.html#SP1" class="internal">weave_plugin</a> and
gives a constructor function for making new ones, <a href="5-wp.html#SP2" class="internal">WeavePlugins::new</a>.
This is then returned as a <code class="display"><span class="extract">weave_plugin *</span></code> pointer which has an infinite
lifespan: though Foundation can also delete objects, Inweb never asks it to.
</p>

<p class="inwebparagraph">Foundation itself contains many useful types, and the most ubiquitous is
<a href="2-str.html#SP15" class="internal">text_stream</a>. This unifies text files and memory-managed strings of Unicode
text. A typical function writing to this might be:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="identifier">Hypothetical::writer</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">authority</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">N</span><span class="plain">) {</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"According to %S, the square of %d is %d.\n"</span><span class="plain">, </span><span class="identifier">authority</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">*</span><span class="identifier">N</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph">Here <code class="display"><span class="extract">WRITE</span></code> is a variadic macro rather like <code class="display"><span class="extract">printf</span></code>, and note the use of
the escape <code class="display"><span class="extract">%S</span></code> to write a text stream. It writes formatted output into the
stream <code class="display"><span class="extract">OUT</span></code>, and is actually an abbreviation for this:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="identifier">Hypothetical::writer</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">authority</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">N</span><span class="plain">) {</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="string">"According to %S, the square of %d is %d.\n"</span><span class="plain">, </span><span class="identifier">authority</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">*</span><span class="identifier">N</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph">The function <code class="display"><span class="extract">Hypothetical::writer</span></code> can write equally to a text file or to a
string, whichever it's given, and doesn't need to worry about memory management
or text encodings.
</p>

<p class="inwebparagraph">The standard output and standard error "files" are written <code class="display"><span class="extract">STDOUT</span></code> and <code class="display"><span class="extract">STDERR</span></code>
as streams; <code class="display"><span class="extract">PRINT("...")</span></code> is an abbreviation for <code class="display"><span class="extract">WRITE_TO(STDOUT, "...")</span></code>.
All of these capitalised macros are defined in <a href="../foundation-module/2-str.html" class="internal">Streams (in foundation)</a>.
</p>

<!--End of weave-->
		</main>
	</body>
</html>

