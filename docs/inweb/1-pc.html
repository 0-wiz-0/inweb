<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Program Control</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Octagram184x184.png" width=72 height=72">
</a></h1>
<ul><li><a href="index.html"><span class="selectedlink">inweb</span></a></li>
</ul><h2>Foundation Module</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../github.png" height=18> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="../../../inform/docs/index.html">inform</a></li>
<li><a href="../../../intest/docs/index.html">intest</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Program Control' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">inweb</a></li><li><a href="index.html#1">Chapter 1: Top Level</a></li><li><b>Program Control</b></li></ul><p class="purpose">The top level, which decides what is to be done and then carries this plan out.</p>

<ul class="toc"><li><a href="#SP6">&#167;6. Main routine</a></li><li><a href="#SP7">&#167;7. Following instructions</a></li><li><a href="#SP8">&#167;8. Error messages</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1.  </b>Inweb syntax has gradually shifted over the years, but there are two main
versions: the second was cleaned up and simplified from the first in 2019.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="identifier">default_inweb_syntax</span><span class="plain"> = </span><span class="constant">V2_SYNTAX</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>Inweb has a single fundamental mode of operation: on any given run, it
is either tangling, weaving or analysing. These processes use the same input
and parsing code, but then do very different things to produce their output,
so the fork in the road is not met until halfway through Inweb's execution.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">NO_MODE</span><span class="definitionkeyword"> from </span><span class="constant">0</span>    <span class="comment"> a special mode for doing nothing except printing command-line syntax</span>
    <span class="definitionkeyword">enum</span> <span class="constant">ANALYSE_MODE</span><span class="plain">   </span><span class="comment"> for -scan, -catalogue, -functions and so on</span>
    <span class="definitionkeyword">enum</span> <span class="constant">TANGLE_MODE</span><span class="plain">    </span><span class="comment"> for any form of -tangle</span>
    <span class="definitionkeyword">enum</span> <span class="constant">WEAVE_MODE</span><span class="plain">     </span><span class="comment"> for any form of -weave</span>
    <span class="definitionkeyword">enum</span> <span class="constant">TRANSLATE_MODE</span><span class="plain"> </span><span class="comment"> a special mode for translating a multi-web makefile</span>
</pre>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="identifier">fundamental_mode</span><span class="plain"> = </span><span class="constant">NO_MODE</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>This operation will be applied to a single web, and will apply to the whole
of that web unless we specify otherwise. Subsets of the web are represented by
short pieces of text called "ranges". This can be a section range like
<code class="display"><span class="extract">2/pine</span></code>, a chapter number like <code class="display"><span class="extract">12</span></code>, an appendix letter <code class="display"><span class="extract">A</span></code> or the
preliminaries block <code class="display"><span class="extract">P</span></code>, the special chapter <code class="display"><span class="extract">S</span></code> for the "Sections" chapter
of an unchaptered web, or the special value <code class="display"><span class="extract">0</span></code> to mean the entire web (which
is the default).
</p>

<p class="inwebparagraph">When weaving in "swarm mode", however, the user chooses a multiplicity of
operations rather than just one. Now it's no longer a matter of weaving a
particular section or chapter: we can weave all of the sections or chapters,
one after another.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">SWARM_OFF_SWM</span><span class="definitionkeyword"> from </span><span class="constant">0</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SWARM_INDEX_SWM</span><span class="plain">    </span><span class="comment"> make index(es) as if swarming, but don't actually swarm</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SWARM_CHAPTERS_SWM</span><span class="plain"> </span><span class="comment"> swarm the chapters</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SWARM_SECTIONS_SWM</span><span class="plain"> </span><span class="comment"> swarm the individual sections</span>
</pre>
<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>In order to run, Inweb needs to know where it is installed &mdash; this
enables it to find its configuration file, the macros file, and so on.
Unless told otherwise on the command line, we'll assume Inweb is present
in the current working directory. The "materials" will then be in a further
subfolder called <code class="display"><span class="extract">Materials</span></code>.
</p>

<pre class="display">
    <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">path_to_inweb</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span><span class="comment"> where we are installed</span>
    <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">path_to_inweb_materials</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span><span class="comment"> the materials pathname</span>
    <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">path_to_inweb_patterns</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span><span class="comment"> where built-in patterns are stored</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b>We count the errors in order to be able to exit with a suitable exit code.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="identifier">no_inweb_errors</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Main routine. </b></p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">main</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">argc</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> **</span><span class="identifier">argv</span><span class="plain">) {</span>
        &lt;<span class="cwebmacro">Initialise inweb</span> <span class="cwebmacronumber">6.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">inweb_instructions</span><span class="plain"> </span><span class="identifier">args</span><span class="plain"> = </span><span class="functiontext"><a href="1-cnf.html#SP2">Configuration::read</a></span><span class="plain">(</span><span class="identifier">argc</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">);</span>
        <span class="identifier">fundamental_mode</span><span class="plain"> = </span><span class="identifier">args</span><span class="plain">.</span><span class="element">inweb_mode</span><span class="plain">;</span>
        <span class="identifier">path_to_inweb</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP3">Pathnames::installation_path</a></span><span class="plain">(</span><span class="string">"INWEB_PATH"</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"inweb"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">args</span><span class="plain">.</span><span class="element">verbose_switch</span><span class="plain">) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Installation path is %p\n"</span><span class="plain">, </span><span class="identifier">path_to_inweb</span><span class="plain">);</span>
        <span class="identifier">path_to_inweb_patterns</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP4">Pathnames::subfolder</a></span><span class="plain">(</span><span class="identifier">path_to_inweb</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Patterns"</span><span class="plain">);</span>
        <span class="identifier">path_to_inweb_materials</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP4">Pathnames::subfolder</a></span><span class="plain">(</span><span class="identifier">path_to_inweb</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Materials"</span><span class="plain">);</span>

        <span class="functiontext"><a href="#SP7">Main::follow_instructions</a></span><span class="plain">(&amp;</span><span class="identifier">args</span><span class="plain">);</span>

        &lt;<span class="cwebmacro">Shut inweb down</span> <span class="cwebmacronumber">6.2</span>&gt;<span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6_1"></a><b>&#167;6.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Initialise inweb</span> <span class="cwebmacronumber">6.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext"><a href="1-fm.html#SP8">Foundation::start</a></span><span class="plain">();</span>
        <span class="functiontext"><a href="5-fm.html#SP3">Formats::create_weave_formats</a></span><span class="plain">();</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_2"></a><b>&#167;6.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Shut inweb down</span> <span class="cwebmacronumber">6.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext"><a href="1-fm.html#SP9">Foundation::end</a></span><span class="plain">();</span>
        <span class="reserved">return</span><span class="plain"> (</span><span class="identifier">no_inweb_errors</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">)?0:1;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7. Following instructions. </b>This is the whole program in a nutshell, and it's a pretty old-school
program: some input, some thinking, a choice of three forms of output.
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Main::follow_instructions<button class="popup" onclick="togglePopup('usagePopup0')">...<span class="popuptext" id="usagePopup0">Usage of <b>Main::follow_instructions</b>:<br><a href="#SP6">&#167;6</a></span></button></span><span class="plain">(</span><span class="reserved">inweb_instructions</span><span class="plain"> *</span><span class="identifier">ins</span><span class="plain">) {</span>
        <span class="reserved">web</span><span class="plain"> *</span><span class="identifier">W</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">chosen_web</span><span class="plain">) || (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_file</span><span class="plain">)) {</span>
            <span class="identifier">W</span><span class="plain"> = </span><span class="functiontext"><a href="2-tr.html#SP4">Reader::load_web</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_web</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_file</span><span class="plain">,</span>
                <span class="functiontext"><a href="8-wm.html#SP6">WebModules::make_search_path</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">import_setting</span><span class="plain">), </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">verbose_switch</span><span class="plain">,</span>
                <span class="constant">TRUE</span><span class="plain">);</span>
            <span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">redirect_weaves_to</span><span class="plain"> = </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">weave_into_setting</span><span class="plain">;</span>
            <span class="functiontext"><a href="2-tr.html#SP5">Reader::read_web</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">verbose_switch</span><span class="plain">);</span>
            <span class="functiontext"><a href="2-tp.html#SP1">Parser::parse_web</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">inweb_mode</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">no_inweb_errors</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">inweb_mode</span><span class="plain"> == </span><span class="constant">TRANSLATE_MODE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Translate a makefile</span> <span class="cwebmacronumber">7.1</span>&gt;
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">show_languages_switch</span><span class="plain">) </span>&lt;<span class="cwebmacro">List available programming languages</span> <span class="cwebmacronumber">7.2</span>&gt;
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">test_language_setting</span><span class="plain">) || (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">test_language_on_setting</span><span class="plain">)) </span>&lt;<span class="cwebmacro">Test a language</span> <span class="cwebmacronumber">7.3</span>&gt;
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">inweb_mode</span><span class="plain"> != </span><span class="constant">NO_MODE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Analyse, tangle or weave an existing web</span> <span class="cwebmacronumber">7.4</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP7_1"></a><b>&#167;7.1.  </b>This is a one-off featurette:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Translate a makefile</span> <span class="cwebmacronumber">7.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">makefile_setting</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">))</span>
            <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"makescript.txt"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">gitignore_setting</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">))</span>
            <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"gitignorescript.txt"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">writeme_setting</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">))</span>
            <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"READMEscript.txt"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">makefile_setting</span><span class="plain">)</span>
            <span class="functiontext"><a href="6-mkf.html#SP1">Makefiles::write</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">makefile_setting</span><span class="plain">,</span>
                <span class="functiontext"><a href="8-wm.html#SP6">WebModules::make_search_path</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">import_setting</span><span class="plain">));</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">gitignore_setting</span><span class="plain">)</span>
            <span class="functiontext"><a href="6-gs.html#SP1">Git::write_gitignore</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">gitignore_setting</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">advance_setting</span><span class="plain">)</span>
            <span class="functiontext"><a href="8-bf.html#SP7">BuildFiles::advance</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">advance_setting</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">writeme_setting</span><span class="plain">)</span>
            <span class="functiontext"><a href="6-rw.html#SP1">Readme::write</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">prototype_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">writeme_setting</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7">&#167;7</a>.</p>

<p class="inwebparagraph"><a id="SP7_2"></a><b>&#167;7.2.  </b>As is this:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">List available programming languages</span> <span class="cwebmacronumber">7.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext"><a href="4-pl.html#SP5">Languages::read_definitions</a></span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="functiontext"><a href="4-pl.html#SP3">Languages::show</a></span><span class="plain">(</span><span class="constant">STDOUT</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7">&#167;7</a>.</p>

<p class="inwebparagraph"><a id="SP7_3"></a><b>&#167;7.3.  </b>And this:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Test a language</span> <span class="cwebmacronumber">7.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">test_language_setting</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">test_language_on_setting</span><span class="plain">)) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">);</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">coloured</span><span class="plain">);</span>
            <span class="functiontext"><a href="4-tp.html#SP7">Painter::colour_file</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">test_language_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">test_language_on_setting</span><span class="plain">,</span>
                <span class="identifier">matter</span><span class="plain">, </span><span class="identifier">coloured</span><span class="plain">);</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Test of colouring for language %S:\n%S\n%S\n"</span><span class="plain">,</span>
                <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">test_language_setting</span><span class="plain">-&gt;</span><span class="element">language_name</span><span class="plain">, </span><span class="identifier">matter</span><span class="plain">, </span><span class="identifier">coloured</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">matter</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">coloured</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="3-em.html#SP2">Errors::fatal</a></span><span class="plain">(</span><span class="string">"-test-language and -test-language-on must both be given"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7">&#167;7</a>.</p>

<p class="inwebparagraph"><a id="SP7_4"></a><b>&#167;7.4.  </b>But otherwise we do something with the given web:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Analyse, tangle or weave an existing web</span> <span class="cwebmacronumber">7.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext"><a href="2-tr.html#SP16">Reader::print_web_statistics</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">inweb_mode</span><span class="plain"> == </span><span class="constant">ANALYSE_MODE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Analyse the web</span> <span class="cwebmacronumber">7.4.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">inweb_mode</span><span class="plain"> == </span><span class="constant">TANGLE_MODE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Tangle the web</span> <span class="cwebmacronumber">7.4.2</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">inweb_mode</span><span class="plain"> == </span><span class="constant">WEAVE_MODE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Weave the web</span> <span class="cwebmacronumber">7.4.3</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7">&#167;7</a>.</p>

<p class="inwebparagraph"><a id="SP7_4_1"></a><b>&#167;7.4.1.  </b>"Analysis" invokes any combination of the following diagnostic tools:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Analyse the web</span> <span class="cwebmacronumber">7.4.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">swarm_mode</span><span class="plain"> != </span><span class="constant">SWARM_OFF_SWM</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-em.html#SP2">Errors::fatal</a></span><span class="plain">(</span><span class="string">"only specific parts of the web can be analysed"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">catalogue_switch</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-ta.html#SP2">Analyser::catalogue_the_sections</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">, </span><span class="constant">BASIC_SECTIONCAT</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">functions_switch</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-ta.html#SP2">Analyser::catalogue_the_sections</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">, </span><span class="constant">FUNCTIONS_SECTIONCAT</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">structures_switch</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-ta.html#SP2">Analyser::catalogue_the_sections</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">, </span><span class="constant">STRUCTURES_SECTIONCAT</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">makefile_setting</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-ta.html#SP13">Analyser::write_makefile</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">makefile_setting</span><span class="plain">,</span>
                <span class="functiontext"><a href="8-wm.html#SP6">WebModules::make_search_path</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">import_setting</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">gitignore_setting</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-ta.html#SP13">Analyser::write_gitignore</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">gitignore_setting</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">advance_switch</span><span class="plain">)</span>
            <span class="functiontext"><a href="8-bf.html#SP7">BuildFiles::advance_for_web</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">scan_switch</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-ta.html#SP1">Analyser::scan_line_categories</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_4">&#167;7.4</a>.</p>

<p class="inwebparagraph"><a id="SP7_4_2"></a><b>&#167;7.4.2.  </b>We can tangle to any one of what might be several targets, numbered upwards
from 0. Target 0 always exists, and is the main program forming the web. For
many webs, this will in fact be the only target, but Inweb also allows
marked sections of a web to be independent targets &mdash; the idea here is to
allow an Appendix in the web to contain a configuration file, or auxiliary
program, needed for the main program to work; this might be written in a
quite different language from the rest of the web, and tangles to a different
output, but needs to be part of the web since it's essential to an understanding
of the whole system.
</p>

<p class="inwebparagraph">In this section we determine <code class="display"><span class="extract">tn</span></code>, the target number wanted, and <code class="display"><span class="extract">tangle_to</span></code>,
the filename of the tangled code to write. This may have been set at the command
line , but otherwise we impose a sensible choice based on the target.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Tangle the web</span> <span class="cwebmacronumber">7.4.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">);</span>
        <span class="reserved">tangle_target</span><span class="plain"> *</span><span class="identifier">tn</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"0"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Work out main tangle destination</span> <span class="cwebmacronumber">7.4.2.1</span>&gt;<span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="2-tr.html#SP8">Reader::get_section_for_range</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Work out an independent tangle destination, from one section of the web</span> <span class="cwebmacronumber">7.4.2.2</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) { </span><span class="functiontext"><a href="3-em.html#SP2">Errors::fatal</a></span><span class="plain">(</span><span class="string">"no tangle destination known"</span><span class="plain">); }</span>

        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">tangle_to</span><span class="plain"> = </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">tangle_setting</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tangle_to</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) {</span>
            <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext"><a href="2-tr.html#SP7">Reader::tangled_folder</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">-&gt;</span><span class="identifier">single_file</span><span class="plain">) </span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP6">Filenames::get_path_to</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">-&gt;</span><span class="element">single_file</span><span class="plain">);</span>
            <span class="identifier">tangle_to</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP2">Filenames::in_folder</a></span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">tangle_leaf</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tn</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">tn</span><span class="plain"> = </span><span class="functiontext"><a href="3-tt.html#SP4">Tangler::primary_target</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">);</span>
        <span class="functiontext"><a href="3-tt.html#SP1">Tangler::go</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">tn</span><span class="plain">, </span><span class="identifier">tangle_to</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_4">&#167;7.4</a>.</p>

<p class="inwebparagraph"><a id="SP7_4_2_1"></a><b>&#167;7.4.2.1.  </b>Here the target number is 0, and the tangle is of the main part of the web,
which for many small webs will be the entire thing.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Work out main tangle destination</span> <span class="cwebmacronumber">7.4.2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">tn</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="8-bdfw.html#SP6">Bibliographic::data_exists</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Short Title"</span><span class="plain">))</span>
            <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">, </span><span class="functiontext"><a href="8-bdfw.html#SP6">Bibliographic::get_datum</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Short Title"</span><span class="plain">));</span>
        <span class="reserved">else</span>
            <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">, </span><span class="functiontext"><a href="8-bdfw.html#SP6">Bibliographic::get_datum</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Title"</span><span class="plain">));</span>
        <span class="functiontext"><a href="4-sm.html#SP16">Str::concatenate</a></span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">-&gt;</span><span class="identifier">main_language</span><span class="plain">-&gt;</span><span class="element">file_extension</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_4_2">&#167;7.4.2</a>.</p>

<p class="inwebparagraph"><a id="SP7_4_2_2"></a><b>&#167;7.4.2.2.  </b>If someone tangles, say, <code class="display"><span class="extract">2/eg</span></code> then the default filename is "Example Section".
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Work out an independent tangle destination, from one section of the web</span> <span class="cwebmacronumber">7.4.2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain"> = </span><span class="functiontext"><a href="2-tr.html#SP8">Reader::get_section_for_range</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">);</span>
        <span class="identifier">tn</span><span class="plain"> = </span><span class="identifier">S</span><span class="plain">-&gt;</span><span class="element">sect_target</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tn</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="functiontext"><a href="3-em.html#SP2">Errors::fatal</a></span><span class="plain">(</span><span class="string">"section cannot be independently tangled"</span><span class="plain">);</span>
        <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">tangle_leaf</span><span class="plain">, </span><span class="functiontext"><a href="3-fln.html#SP7">Filenames::get_leafname</a></span><span class="plain">(</span><span class="identifier">S</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">-&gt;</span><span class="element">source_file_for_section</span><span class="plain">));</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_4_2">&#167;7.4.2</a>.</p>

<p class="inwebparagraph"><a id="SP7_4_3"></a><b>&#167;7.4.3.  </b>Weaving is not actually easier, it's just more thoroughly delegated:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Weave the web</span> <span class="cwebmacronumber">7.4.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext"><a href="2-pn.html#SP1">Numbering::number_web</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">);</span>

        <span class="reserved">theme_tag</span><span class="plain"> *</span><span class="identifier">tag</span><span class="plain"> = </span><span class="functiontext"><a href="2-tgs.html#SP2">Tags::find_by_name</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">tag_setting</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">tag_setting</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">tag</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">))</span>
            <span class="functiontext"><a href="3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"no such theme as '%S'"</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">tag_setting</span><span class="plain">);</span>

        <span class="reserved">weave_pattern</span><span class="plain"> *</span><span class="identifier">pattern</span><span class="plain"> = </span><span class="functiontext"><a href="1-ptt.html#SP2">Patterns::find</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">weave_pattern</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="identifier">chosen_range_actually_chosen</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_file</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">))</span>
            <span class="functiontext"><a href="1-cnf.html#SP4">Configuration::set_range</a></span><span class="plain">(</span><span class="identifier">ins</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">-&gt;</span><span class="element">default_range</span><span class="plain">);</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">r</span><span class="plain"> = </span><span class="functiontext"><a href="5-fm.html#SP4">Formats::begin_weaving</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">r</span><span class="plain"> != </span><span class="constant">SWARM_OFF_SWM</span><span class="plain">) </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">swarm_mode</span><span class="plain"> = </span><span class="identifier">r</span><span class="plain">;</span>
        &lt;<span class="cwebmacro">Assign section numbers for printing purposes</span> <span class="cwebmacronumber">7.4.3.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">swarm_mode</span><span class="plain"> == </span><span class="constant">SWARM_OFF_SWM</span><span class="plain">) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">shall_we_open</span><span class="plain"> = </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">open_pdf_switch</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">shall_we_open</span><span class="plain"> == </span><span class="constant">NOT_APPLICABLE</span><span class="plain">) { </span><span class="comment"> i.e., if it wasn't set at the command line</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">pattern</span><span class="plain">-&gt;</span><span class="element">open_command</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">shall_we_open</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                <span class="reserved">else</span><span class="plain"> </span><span class="identifier">shall_we_open</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="plain">}</span>
            <span class="functiontext"><a href="3-ts.html#SP2">Swarm::weave_subset</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">, </span><span class="identifier">shall_we_open</span><span class="plain">, </span><span class="identifier">tag</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">,</span>
                <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">weave_to_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">weave_into_setting</span><span class="plain">,</span>
                <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">breadcrumb_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">navigation_setting</span><span class="plain">);</span>
            <span class="functiontext"><a href="1-ptt.html#SP6">Patterns::copy_payloads_into_weave</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="3-ts.html#SP1">Swarm::weave</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">swarm_mode</span><span class="plain">, </span><span class="identifier">tag</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">,</span>
                <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">weave_to_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">weave_into_setting</span><span class="plain">,</span>
                <span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">breadcrumb_setting</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">navigation_setting</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="5-fm.html#SP4">Formats::end_weaving</a></span><span class="plain">(</span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">pattern</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_4">&#167;7.4</a>.</p>

<p class="inwebparagraph"><a id="SP7_4_3_1"></a><b>&#167;7.4.3.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Assign section numbers for printing purposes</span> <span class="cwebmacronumber">7.4.3.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">section</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain">; </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">k</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="reserved">section</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="2-tr.html#SP10">Reader::range_within</a></span><span class="plain">(</span><span class="identifier">S</span><span class="plain">-&gt;</span><span class="element">md</span><span class="plain">-&gt;</span><span class="element">sect_range</span><span class="plain">, </span><span class="identifier">ins</span><span class="plain">-&gt;</span><span class="element">chosen_range</span><span class="plain">))</span>
                <span class="identifier">S</span><span class="plain">-&gt;</span><span class="element">printed_number</span><span class="plain"> = </span><span class="identifier">k</span><span class="plain">++;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_4_3">&#167;7.4.3</a>.</p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8. Error messages. </b>The Foundation module provides convenient functions to issue error messages,
but we'll use the following wrapper when issuing an error at a line of web
source:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Main::error_in_web<button class="popup" onclick="togglePopup('usagePopup1')">...<span class="popuptext" id="usagePopup1">Usage of <b>Main::error_in_web</b>:<br>Configuration - <a href="1-cnf.html#SP4">&#167;4</a><br>The Parser - <a href="2-tp.html#SP1_1_6_3">&#167;1.1.6.3</a>, <a href="2-tp.html#SP1_1_6_4">&#167;1.1.6.4</a>, <a href="2-tp.html#SP1_1_6_7">&#167;1.1.6.7</a>, <a href="2-tp.html#SP1_1_6_7_1">&#167;1.1.6.7.1</a>, <a href="2-tp.html#SP1_1_6_5_1">&#167;1.1.6.5.1</a>, <a href="2-tp.html#SP1_1_6_5_1_1">&#167;1.1.6.5.1.1</a>, <a href="2-tp.html#SP1_1_6_5_1_2">&#167;1.1.6.5.1.2</a>, <a href="2-tp.html#SP1_1_6_5_1_3">&#167;1.1.6.5.1.3</a>, <a href="2-tp.html#SP1_1_6_5_1_4">&#167;1.1.6.5.1.4</a>, <a href="2-tp.html#SP1_1_6_5_1_7">&#167;1.1.6.5.1.7</a>, <a href="2-tp.html#SP3">&#167;3</a><br>Enumerated Constants - <a href="2-ec.html#SP3_1">&#167;3.1</a>, <a href="2-ec.html#SP3_2">&#167;3.2</a>, <a href="2-ec.html#SP3_3">&#167;3.3</a><br>The Analyser - <a href="3-ta.html#SP4_1">&#167;4.1</a><br>The Weaver - <a href="3-tw.html#SP1_3_4_1_8_5">&#167;1.3.4.1.8.5</a><br>The Tangler - <a href="3-tt.html#SP1_1_1_1">&#167;1.1.1.1</a>, <a href="3-tt.html#SP3_1">&#167;3.1</a><br>Types and Functions - <a href="4-taf.html#SP7_3">&#167;7.3</a><br>Language Methods - <a href="4-lm.html#SP10">&#167;10</a><br>C-Like Languages - <a href="4-cl.html#SP3">&#167;3</a>, <a href="4-cl.html#SP3_1">&#167;3.1</a>, <a href="4-cl.html#SP3_2_2_1">&#167;3.2.2.1</a>, <a href="4-cl.html#SP9">&#167;9</a><br>HTML Formats - <a href="5-hf.html#SP19">&#167;19</a><br>Weave Plugins - <a href="5-wp.html#SP3">&#167;3</a><br>Colonies - <a href="6-cln.html#SP8_4">&#167;8.4</a>, <a href="6-cln.html#SP10">&#167;10</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">message</span><span class="plain">, </span><span class="reserved">source_line</span><span class="plain"> *</span><span class="identifier">sl</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">sl</span><span class="plain">) {</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file_S</a></span><span class="plain">(</span><span class="identifier">message</span><span class="plain">, &amp;(</span><span class="identifier">sl</span><span class="plain">-&gt;</span><span class="element">source</span><span class="plain">));</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="constant">STDERR</span><span class="plain">, </span><span class="string">"%07d  %S\n"</span><span class="plain">, </span><span class="identifier">sl</span><span class="plain">-&gt;</span><span class="element">source</span><span class="plain">.</span><span class="element">line_count</span><span class="plain">, </span><span class="identifier">sl</span><span class="plain">-&gt;</span><span class="element">text</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file_S</a></span><span class="plain">(</span><span class="identifier">message</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">no_inweb_errors</span><span class="plain">++;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><a href="1-bsc.html">Back to 'Basics'</a></li><li><a href="1-cnf.html">Continue with 'Configuration'</a></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

