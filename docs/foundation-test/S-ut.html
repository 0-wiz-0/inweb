<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>S/pc</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>

<!--Weave of 'S/ut' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">&#9733;</a></li><li><a href="index.html">foundation-test</a></li><li><b>Unit Tests</b></li></ul><p class="purpose">A selection of tests for, or demonstrations of, foundation features.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Strings</a></li><li><a href="#SP2">&#167;2. Literals</a></li><li><a href="#SP3">&#167;3. Dictionaries</a></li><li><a href="#SP4">&#167;4. Regexp</a></li><li><a href="#SP5">&#167;5. Replacements</a></li><li><a href="#SP6">&#167;6. Linked lists</a></li><li><a href="#SP7">&#167;7. Stacks</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Strings. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_strings</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">S</span><span class="plain"> = </span><span class="functiontext">Str::new_from_wide_string</span><span class="plain">(</span><span class="identifier">L</span><span class="string">"Jack and Jill"</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Setup: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">S</span><span class="plain">);</span>

        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">T</span><span class="plain"> = </span><span class="functiontext">Str::new_from_wide_string</span><span class="plain">(</span><span class="identifier">L</span><span class="string">" had a great fall"</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Plus: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">T</span><span class="plain">);</span>
        <span class="functiontext">Str::concatenate</span><span class="plain">(</span><span class="identifier">S</span><span class="plain">, </span><span class="identifier">T</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Concatenation: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">S</span><span class="plain">);</span>

        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">BB</span><span class="plain"> = </span><span class="functiontext">Str::new_from_wide_string</span><span class="plain">(</span><span class="identifier">L</span><span class="string">"   banana bread  is fun   "</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Setup statically: &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">BB</span><span class="plain">);</span>
        <span class="functiontext">Str::trim_white_space</span><span class="plain">(</span><span class="identifier">BB</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Trimmed: &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">BB</span><span class="plain">);</span>

        <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">BB</span><span class="plain">, </span><span class="identifier">S</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Copied: &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">BB</span><span class="plain">);</span>

        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Length: %d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">BB</span><span class="plain">));</span>

        <span class="functiontext">Str::put</span><span class="plain">(</span><span class="functiontext">Str::at</span><span class="plain">(</span><span class="identifier">BB</span><span class="plain">, 3), </span><span class="identifier">L</span><span class="character">'Q'</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Modified: &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">BB</span><span class="plain">);</span>

        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">A</span><span class="plain"> = </span><span class="functiontext">Str::new_from_wide_string</span><span class="plain">(</span><span class="identifier">L</span><span class="string">"fish"</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">B</span><span class="plain"> = </span><span class="functiontext">Str::new_from_wide_string</span><span class="plain">(</span><span class="identifier">L</span><span class="string">"Fish"</span><span class="plain">);</span>

        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S eq %S? %d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">, </span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">));</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S ci-eq %S? %d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">, </span><span class="functiontext">Str::eq_insensitive</span><span class="plain">(</span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">));</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S ne %S? %d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">, </span><span class="functiontext">Str::ne</span><span class="plain">(</span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">));</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S ci-ne %S? %d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">, </span><span class="functiontext">Str::ne_insensitive</span><span class="plain">(</span><span class="identifier">A</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">));</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_strings is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Literals. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_literals</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"This is \</span><span class="plain">"</span><span class="string">tricky"</span><span class="plain">); </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"bananas"</span><span class="plain">);</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">z</span><span class="plain"> = </span><span class="character">'"'</span><span class="plain">; </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">"%S%d"</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"peaches"</span><span class="plain">, </span><span class="identifier">z</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">A</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"Jackdaws love my big sphinx of quartz"</span><span class="plain">;</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"So A is &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">A</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">B</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"Jackdaws love my big sphinx of quartz"</span><span class="plain">;</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"So B is &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">B</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"Jinxed wizards pluck ivy from my quilt"</span><span class="plain">;</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"So C is &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">A</span><span class="plain"> != </span><span class="identifier">B</span><span class="plain">) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"FAIL: A != B\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"and A == B as pointers, too\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_literals is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3. Dictionaries. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_dictionaries</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">arg</span><span class="plain">) {</span>
        <span class="reserved">dictionary</span><span class="plain"> *</span><span class="identifier">D</span><span class="plain"> = </span><span class="functiontext">Dictionaries::new</span><span class="plain">(2, </span><span class="constant">TRUE</span><span class="plain">);</span>
        <span class="functiontext">Dictionaries::log</span><span class="plain">(</span><span class="constant">STDOUT</span><span class="plain">, </span><span class="identifier">D</span><span class="plain">);</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">arg</span><span class="plain">);</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read file of test cases"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Unit::test_dictionaries_helper1</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">D</span><span class="plain">);</span>
        <span class="functiontext">Dictionaries::log</span><span class="plain">(</span><span class="constant">STDOUT</span><span class="plain">, </span><span class="identifier">D</span><span class="plain">);</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to reread file of test cases"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Unit::test_dictionaries_helper2</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">D</span><span class="plain">);</span>
        <span class="functiontext">Dictionaries::log</span><span class="plain">(</span><span class="constant">STDOUT</span><span class="plain">, </span><span class="identifier">D</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_dictionaries_helper1</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">vD</span><span class="plain">) {</span>
        <span class="reserved">dictionary</span><span class="plain"> *</span><span class="identifier">D</span><span class="plain"> = (</span><span class="reserved">dictionary</span><span class="plain"> *) </span><span class="identifier">vD</span><span class="plain">;</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%'(%c*?)%' %'(%c*)%'"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Dictionaries::find</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]) == </span><span class="identifier">NULL</span><span class="plain">) {</span>
                <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Creating new entry &lt;%S&gt;\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                <span class="functiontext">Dictionaries::create_text</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Dictionaries::find</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]) == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Didn't create\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="functiontext">Dictionaries::get_text</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]), </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1]);</span>
            <span class="reserved">if</span><span class="plain"> (!</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1], </span><span class="functiontext">Dictionaries::get_text</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0])))</span>
                <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"FAIL: can't read back entry once written\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
            <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="functiontext">Errors::in_text_file</span><span class="plain">(</span><span class="string">"test case won't parse"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_dictionaries_helper2</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">vD</span><span class="plain">) {</span>
        <span class="reserved">dictionary</span><span class="plain"> *</span><span class="identifier">D</span><span class="plain"> = (</span><span class="reserved">dictionary</span><span class="plain"> *) </span><span class="identifier">vD</span><span class="plain">;</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%'(%c*?)%' %'(%c*)%'"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Dictionaries::find</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]) == </span><span class="identifier">NULL</span><span class="plain">) {</span>
                <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Missing %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="functiontext">Dictionaries::destroy</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Dictionaries::find</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0])) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Didn't destroy\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="functiontext">Errors::in_text_file</span><span class="plain">(</span><span class="string">"test case won't parse"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_dictionaries is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<p class="endnote">The function Unit::test_dictionaries_helper1 appears nowhere else.</p>

<p class="endnote">The function Unit::test_dictionaries_helper2 appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4. Regexp. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_regexp</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">arg</span><span class="plain">) {</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">arg</span><span class="plain">);</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read file of test cases"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Unit::test_regexp_helper</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_regexp_helper</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%'(%c*?)%' %'(%c*)%'"</span><span class="plain">)) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">pattern</span><span class="plain">[1024];</span>
            <span class="functiontext">Str::copy_to_wide_string</span><span class="plain">(</span><span class="identifier">pattern</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1], 1024);</span>
            <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr2</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Text &lt;%S&gt; pattern &lt;%w&gt;: "</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">pattern</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">pattern</span><span class="plain">)) {</span>
                <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Match"</span><span class="plain">);</span>
                <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">mr2</span><span class="element">.no_matched_texts</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++)</span>
                    <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">" %d=&lt;%S&gt;"</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">mr2</span><span class="element">.exp</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">]);</span>
                <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
                <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"No match\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="functiontext">Errors::in_text_file</span><span class="plain">(</span><span class="string">"test case won't parse"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_regexp is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<p class="endnote">The function Unit::test_regexp_helper appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5. Replacements. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_replacement</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">arg</span><span class="plain">) {</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">arg</span><span class="plain">);</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read file of test cases"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Unit::test_replacement_helper</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_replacement_helper</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%'(%c*?)%' %'(%c*?)%' %'(%c*)%'"</span><span class="plain">)) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">pattern</span><span class="plain">[1024];</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">replacement</span><span class="plain">[1024];</span>
            <span class="functiontext">Str::copy_to_wide_string</span><span class="plain">(</span><span class="identifier">pattern</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1], 1024);</span>
            <span class="functiontext">Str::copy_to_wide_string</span><span class="plain">(</span><span class="identifier">replacement</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[2], 1024);</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Text &lt;%S&gt; pattern &lt;%w&gt; replacement &lt;%w&gt;: "</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">pattern</span><span class="plain">, </span><span class="identifier">replacement</span><span class="plain">);</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">rc</span><span class="plain"> = </span><span class="functiontext">Regexp::replace</span><span class="plain">(</span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">pattern</span><span class="plain">, </span><span class="identifier">replacement</span><span class="plain">, </span><span class="constant">REP_REPEATING</span><span class="plain">);</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S (%d replacement%s)\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">rc</span><span class="plain">, (</span><span class="identifier">rc</span><span class="plain"> == 1)?</span><span class="string">""</span><span class="plain">:</span><span class="string">"s"</span><span class="plain">);</span>
            <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="functiontext">Errors::in_text_file</span><span class="plain">(</span><span class="string">"test case won't parse"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_replacement is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<p class="endnote">The function Unit::test_replacement_helper appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Linked lists. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_linked_lists</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">test_list</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"List (which should be empty) contains:\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_list</span><span class="plain">) {</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain"> = 1; </span><span class="identifier">i</span><span class="plain">&lt;17; </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="string">"S%d"</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
            <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="functiontext">Str::duplicate</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">), </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_list</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"List contains:\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_list</span><span class="plain">) {</span>
            <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"And has length %d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="functiontext">LinkedLists::len</span><span class="plain">(</span><span class="identifier">test_list</span><span class="plain">));</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"First is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">FIRST_IN_LINKED_LIST</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_list</span><span class="plain">));</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Last is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">LAST_IN_LINKED_LIST</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_list</span><span class="plain">));</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_linked_lists is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7. Stacks. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Unit::test_stacks</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="constant">lifo_stack</span><span class="plain"> *</span><span class="identifier">test_stack</span><span class="plain"> = </span><span class="identifier">NEW_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">PUSH_TO_LIFO_STACK</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Mercury"</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">PUSH_TO_LIFO_STACK</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Venus"</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">POP_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">PUSH_TO_LIFO_STACK</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Earth"</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">POP_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">POP_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Top of stack is: %S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">TOP_OF_LIFO_STACK</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">));</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LIFO_STACK_EMPTY</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">test_stack</span><span class="plain">)) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Stack is empty\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Unit::test_stacks is used in S/pc (<a href="S-pc.html#SP1">&#167;1</a>).</p>

<hr class="tocbar">
<ul class="toc"><li><a href="S-pc.html">Back to 'Program Control'</a></li><li><i>(This section ends Sections.)</i></li></ul><hr class="tocbar">
<!--End of weave-->
	</body>
</html>

